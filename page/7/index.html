<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"kyosora.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":true,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"找到 ${hits} 個搜索結果（用時 ${time} 毫秒）","hits":"找到 ${hits} 個搜索結果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="個人技術筆記和學習心得分享">
<meta property="og:type" content="website">
<meta property="og:title" content="kyosora 虛空筆記">
<meta property="og:url" content="https://kyosora.github.io/page/7/">
<meta property="og:site_name" content="kyosora 虛空筆記">
<meta property="og:description" content="個人技術筆記和學習心得分享">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="kyosora">
<meta property="article:tag" content="網路安全, 系統管理, 程式設計, 技術筆記">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://kyosora.github.io/page/7/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-TW","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>kyosora 虛空筆記</title>
  





  <script class="next-config" data-name="matomo" type="application/json">{"enable":true,"server_url":null,"site_id":null}</script>
  <script src="/js/third-party/analytics/matomo.js" defer></script>

  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/comments.js" defer></script><script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/5.36.0/lite/builds/browser.umd.js" integrity="sha256-o49zoHLDPBm9WLg6AiliAVi3axCRTqe3ltTxLvhzAVg=" crossorigin="anonymous" defer></script><script src="/js/third-party/search/algolia-search.js" defer></script>
<script class="next-config" data-name="chatra" type="application/json">{"enable":true,"async":true,"id":null}</script>
<script src="/js/third-party/chat/chatra.js" defer></script>
<script async src="https://call.chatra.io/chatra.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js" defer></script>


  <script src="/js/third-party/pace.js" defer></script>

  <script src="/js/third-party/addtoany.js" defer></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/12.2.1/firebase-app-compat.js" integrity="sha256-d21UgtIcA6c6qwr8nWk6lxs/KrpbWhknQN7qBjWA2Kk=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/12.2.1/firebase-firestore-compat.js" integrity="sha256-leHatffkFuVGIg7ABaA5BDsqsEUtktL4tftb3OdQfg0=" crossorigin="anonymous" defer></script>
  <script class="next-config" data-name="firestore" type="application/json">{"enable":true,"collection":"articles","apiKey":null,"projectId":null}</script>
  <script src="/js/third-party/statistics/firestore.js" defer></script>



  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/3.0.1/quicklink.umd.js" integrity="sha256-44BednzIpUeQJcY8qtLyarFu0UCCTbgmWOvaoehiFQQ=" crossorigin="anonymous" defer></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":false,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://kyosora.github.io/page/7/"}</script>
  <script src="/js/third-party/quicklink.js" defer></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">kyosora 虛空筆記</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">技術探索與學習分享</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜尋..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fab fa-algolia fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">kyosora</p>
  <div class="site-description" itemprop="description">個人技術筆記和學習心得分享</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">110</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">分類</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">155</span>
        <span class="site-state-item-name">標籤</span>
      </div>
  </nav>
</div>
  <div class="sidebar-button animated">
    <button><i class="fa fa-comment"></i>
      聊天
    </button>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">從零開始的 Docker 容器化指南: Vue3 + .NET Core + SQL Server</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-08-20 18:11:01" itemprop="dateCreated datePublished" datetime="2024-08-20T18:11:01+08:00">2024-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:51:00" itemprop="dateModified" datetime="2024-11-27T14:51:00+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BC%8F%E6%95%99%E5%AD%B8/" itemprop="url" rel="index"><span itemprop="name">程式教學</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>5.9k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>5 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="從零開始的-Docker-容器化指南-Vue3-NET-Core-SQL-Server"><a href="#從零開始的-Docker-容器化指南-Vue3-NET-Core-SQL-Server" class="headerlink" title="從零開始的 Docker 容器化指南: Vue3 + .NET Core + SQL Server"></a>從零開始的 Docker 容器化指南: Vue3 + .NET Core + SQL Server</h1><h2 id="目錄"><a href="#目錄" class="headerlink" title="目錄"></a>目錄</h2><ul>
<li><a href="#docker-%E5%9F%BA%E7%A4%8E%E6%A6%82%E5%BF%B5">Docker 基礎概念</a></li>
<li><a href="#%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99">環境準備</a></li>
<li><a href="#sql-server-%E5%AE%B9%E5%99%A8%E8%A8%AD%E5%AE%9A">SQL Server 容器設定</a></li>
<li><a href="#net-core-api-%E5%AE%B9%E5%99%A8%E5%8C%96">.NET Core API 容器化</a></li>
<li><a href="#vue3-%E5%89%8D%E7%AB%AF%E5%AE%B9%E5%99%A8%E5%8C%96">Vue3 前端容器化</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-docker-compose-%E6%95%B4%E5%90%88%E6%9C%8D%E5%8B%99">使用 Docker Compose 整合服務</a></li>
<li><a href="#%E8%B3%87%E6%BA%90%E7%AE%A1%E7%90%86%E8%88%87%E7%9B%A3%E6%8E%A7">資源管理與監控</a></li>
<li><a href="#%E9%96%8B%E7%99%BC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A">開發環境設定</a></li>
<li><a href="#%E7%B6%B2%E8%B7%AF%E9%85%8D%E7%BD%AE">網路配置</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E8%88%87%E7%B6%AD%E8%AD%B7">部署與維護</a></li>
<li><a href="#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C%E8%88%87%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88">常見問題與解決方案</a></li>
</ul>
<h2 id="Docker-基礎概念"><a href="#Docker-基礎概念" class="headerlink" title="Docker 基礎概念"></a>Docker 基礎概念</h2><p>Docker 是一個開放原始碼的容器化平台，它可以讓我們將應用程式和其依賴項打包成一個獨立的容器。容器就像是一個輕量級的虛擬機，可以在任何支援 Docker 的環境中運行。</p>
<p>主要優點：</p>
<ul>
<li>環境一致性</li>
<li>快速部署</li>
<li>資源效率</li>
<li>易於擴展</li>
</ul>
<h2 id="環境準備"><a href="#環境準備" class="headerlink" title="環境準備"></a>環境準備</h2><ol>
<li><p>安裝 Docker Desktop</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows/Mac 下載並安裝 Docker Desktop</span></span><br><span class="line">https://www.docker.com/products/docker-desktop/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux (Ubuntu) 安裝 Docker Engine</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install docker.io</span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure></li>
<li><p>確認安裝</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="SQL-Server-容器設定"><a href="#SQL-Server-容器設定" class="headerlink" title="SQL Server 容器設定"></a>SQL Server 容器設定</h2><ol>
<li><p>建立 SQL Server 容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker pull mcr.microsoft.com/mssql/server:2019-latest</span><br><span class="line"></span><br><span class="line">docker run -e <span class="string">&quot;ACCEPT_EULA=Y&quot;</span> -e <span class="string">&quot;SA_PASSWORD=YourStrong@Passw0rd&quot;</span> \</span><br><span class="line">   -p 1433:1433 --name sqlserver \</span><br><span class="line">   -v sqlvolume:/var/opt/mssql \</span><br><span class="line">   -d mcr.microsoft.com/mssql/server:2019-latest</span><br></pre></td></tr></table></figure></li>
<li><p>確認容器運行狀態</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="NET-Core-API-容器化"><a href="#NET-Core-API-容器化" class="headerlink" title=".NET Core API 容器化"></a>.NET Core API 容器化</h2><ol>
<li><p>在專案根目錄建立 Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> mcr.microsoft.com/dotnet/sdk:<span class="number">6.0</span> AS build</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /src</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> [<span class="string">&quot;YourProject.csproj&quot;</span>, <span class="string">&quot;./&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dotnet restore</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> dotnet build -c Release -o /app/build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> mcr.microsoft.com/dotnet/aspnet:<span class="number">6.0</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build /app/build .</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;dotnet&quot;</span>, <span class="string">&quot;YourProject.dll&quot;</span>]</span></span><br></pre></td></tr></table></figure></li>
<li><p>設定 .dockerignore</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/</span><br><span class="line">obj/</span><br><span class="line">node_modules/</span><br></pre></td></tr></table></figure></li>
<li><p>建立映像檔和容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myapi .</span><br><span class="line">docker run -d -p 5000:80 --name api myapi</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Vue3-前端容器化"><a href="#Vue3-前端容器化" class="headerlink" title="Vue3 前端容器化"></a>Vue3 前端容器化</h2><ol>
<li><p>建立 Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">16</span> as build-stage</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> nginx:stable-alpine as production-stage</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build-stage /app/dist /usr/share/nginx/html</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure></li>
<li><p>建立映像檔和容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myvue .</span><br><span class="line">docker run -d -p 8080:80 --name frontend myvue</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="使用-Docker-Compose-整合服務"><a href="#使用-Docker-Compose-整合服務" class="headerlink" title="使用 Docker Compose 整合服務"></a>使用 Docker Compose 整合服務</h2><ol>
<li><p>建立 docker-compose.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mcr.microsoft.com/mssql/server:2019-latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ACCEPT_EULA=Y</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SA_PASSWORD=YourStrong@Passw0rd</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;1433:1433&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sqlvolume:/var/opt/mssql</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./api</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5000:80&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ConnectionStrings__DefaultConnection=Server=db;Database=YourDB;User=sa;Password=YourStrong@Passw0rd;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./frontend</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:80&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">api</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">sqlvolume:</span></span><br></pre></td></tr></table></figure></li>
<li><p>啟動所有服務</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></li>
<li><p>檢查服務狀態</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose ps</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="資源管理與監控"><a href="#資源管理與監控" class="headerlink" title="資源管理與監控"></a>資源管理與監控</h2><h3 id="容器資源限制"><a href="#容器資源限制" class="headerlink" title="容器資源限制"></a>容器資源限制</h3><p>為了確保系統穩定性，我們需要為容器設定適當的資源限制：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&#x27;0.5&#x27;</span>    <span class="comment"># 限制最多使用 50% CPU</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">512M</span>   <span class="comment"># 限制最大記憶體使用量</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&#x27;0.25&#x27;</span>   <span class="comment"># 保證至少 25% CPU</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">256M</span>   <span class="comment"># 保證最少記憶體</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">2G</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">sqlvolume:/var/opt/mssql</span></span><br><span class="line">    <span class="attr">storage_opts:</span></span><br><span class="line">      <span class="attr">size:</span> <span class="string">&#x27;10G&#x27;</span>  <span class="comment"># 限制容器儲存空間</span></span><br></pre></td></tr></table></figure>

<h3 id="監控工具設定"><a href="#監控工具設定" class="headerlink" title="監控工具設定"></a>監控工具設定</h3><h4 id="1-Portainer-安裝"><a href="#1-Portainer-安裝" class="headerlink" title="1. Portainer 安裝"></a>1. Portainer 安裝</h4><p>Portainer 提供了直覺的 Web 介面來管理 Docker 容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker volume create portainer_data</span><br><span class="line">docker run -d -p 9000:9000 --name=portainer --restart=always \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    -v portainer_data:/data \</span><br><span class="line">    portainer/portainer-ce</span><br></pre></td></tr></table></figure>

<p>安裝完成後可以訪問 <a target="_blank" rel="noopener" href="http://localhost:9000/">http://localhost:9000</a> 進行設定。</p>
<h4 id="2-日誌管理"><a href="#2-日誌管理" class="headerlink" title="2. 日誌管理"></a>2. 日誌管理</h4><p>在 docker-compose.yml 中加入日誌設定：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">logging:</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">&quot;json-file&quot;</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">        <span class="attr">max-size:</span> <span class="string">&quot;200m&quot;</span></span><br><span class="line">        <span class="attr">max-file:</span> <span class="string">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="開發環境設定"><a href="#開發環境設定" class="headerlink" title="開發環境設定"></a>開發環境設定</h2><h3 id="Hot-Reload-配置"><a href="#Hot-Reload-配置" class="headerlink" title="Hot Reload 配置"></a>Hot Reload 配置</h3><p>為了提升開發效率，我們可以設定 Hot Reload：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.override.yml</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/app</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/obj</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ASPNETCORE_ENVIRONMENT=Development</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOTNET_USE_POLLING_FILE_WATCHER=true</span></span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">dotnet</span> <span class="string">watch</span> <span class="string">run</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./src:/app/src</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-設定"><a href="#Debug-設定" class="headerlink" title="Debug 設定"></a>Debug 設定</h3><p>在 VS Code 中設定容器除錯：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .vscode/launch.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Docker .NET Core Attach&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;coreclr&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;attach&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;processName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YourProject&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pipeTransport&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;pipeProgram&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;pipeArgs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;exec&quot;</span><span class="punctuation">,</span> <span class="string">&quot;-i&quot;</span><span class="punctuation">,</span> <span class="string">&quot;api&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;debuggerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/vsdbg/vsdbg&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="網路配置"><a href="#網路配置" class="headerlink" title="網路配置"></a>網路配置</h2><h3 id="網路隔離"><a href="#網路隔離" class="headerlink" title="網路隔離"></a>網路隔離</h3><p>為了提高安全性，我們可以將服務分配到不同的網路：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">    <span class="attr">internal:</span> <span class="literal">true</span>  <span class="comment"># 只允許內部存取</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">frontend</span></span><br></pre></td></tr></table></figure>

<h2 id="部署與維護"><a href="#部署與維護" class="headerlink" title="部署與維護"></a>部署與維護</h2><h3 id="CI-CD-整合"><a href="#CI-CD-整合" class="headerlink" title="CI/CD 整合"></a>CI/CD 整合</h3><p>以下是一個使用 GitHub Actions 的範例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .github/workflows/docker-publish.yml</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Docker</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Push</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">main</span> ]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Login</span> <span class="string">to</span> <span class="string">Docker</span> <span class="string">Hub</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/login-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_HUB_USERNAME</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_HUB_ACCESS_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">push</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/build-push-action@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">          <span class="attr">push:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">user/myapp:latest</span></span><br></pre></td></tr></table></figure>

<h3 id="環境變數管理"><a href="#環境變數管理" class="headerlink" title="環境變數管理"></a>環境變數管理</h3><p>建立不同環境的設定檔：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env.development</span></span><br><span class="line">DB_PASSWORD=dev_password</span><br><span class="line">API_URL=http://localhost:5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># .env.production</span></span><br><span class="line">DB_PASSWORD=<span class="variable">$&#123;PROD_DB_PASSWORD&#125;</span></span><br><span class="line">API_URL=https://api.example.com</span><br></pre></td></tr></table></figure>

<h3 id="自動化部署腳本"><a href="#自動化部署腳本" class="headerlink" title="自動化部署腳本"></a>自動化部署腳本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># deploy.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取最新映像檔</span></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用生產環境設定檔</span></span><br><span class="line"><span class="built_in">export</span> COMPOSE_FILE=docker-compose.yml:docker-compose.prod.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新服務</span></span><br><span class="line">docker-compose up -d --remove-orphans</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理舊映像檔</span></span><br><span class="line">docker image prune -f</span><br></pre></td></tr></table></figure>

<h2 id="常見問題與解決方案"><a href="#常見問題與解決方案" class="headerlink" title="常見問題與解決方案"></a>常見問題與解決方案</h2><h3 id="1-SQL-Server-連線問題"><a href="#1-SQL-Server-連線問題" class="headerlink" title="1. SQL Server 連線問題"></a>1. SQL Server 連線問題</h3><ul>
<li>確認連線字串中的主機名稱使用服務名稱 (db)</li>
<li>確認 SA 密碼符合複雜度要求</li>
<li>檢查防火牆設定</li>
</ul>
<h3 id="2-NET-Core-API-容器化問題"><a href="#2-NET-Core-API-容器化問題" class="headerlink" title="2. .NET Core API 容器化問題"></a>2. .NET Core API 容器化問題</h3><ul>
<li>確保 Dockerfile 中的專案名稱正確</li>
<li>檢查 ASPNETCORE_URLS 環境變數設定</li>
<li>確認 API 監聽的埠號設定</li>
</ul>
<h3 id="3-Vue3-建置問題"><a href="#3-Vue3-建置問題" class="headerlink" title="3. Vue3 建置問題"></a>3. Vue3 建置問題</h3><ul>
<li>確保 node_modules 已被正確忽略</li>
<li>檢查 nginx 設定是否正確</li>
<li>確認環境變數檔案 (.env) 設定</li>
</ul>
<h3 id="4-效能優化相關"><a href="#4-效能優化相關" class="headerlink" title="4. 效能優化相關"></a>4. 效能優化相關</h3><h4 id="映像檔優化"><a href="#映像檔優化" class="headerlink" title="映像檔優化"></a>映像檔優化</h4><ul>
<li>使用多階段建置減少映像檔大小</li>
<li>選用 alpine 版本的基礎映像檔</li>
<li>適當使用 .dockerignore 排除不必要檔案</li>
</ul>
<h4 id="容器效能優化"><a href="#容器效能優化" class="headerlink" title="容器效能優化"></a>容器效能優化</h4><ul>
<li>設定適當的記憶體和 CPU 限制</li>
<li>使用 Volume 而非 bind mount</li>
<li>定期清理未使用的容器和映像檔</li>
</ul>
<h4 id="網路效能"><a href="#網路效能" class="headerlink" title="網路效能"></a>網路效能</h4><ul>
<li>使用內部網路進行容器間通訊</li>
<li>合理設計網路拓撲</li>
<li>需要時使用 DNS 快取</li>
</ul>
<h2 id="安全性建議"><a href="#安全性建議" class="headerlink" title="安全性建議"></a>安全性建議</h2><p>除了之前提到的最佳實踐外，還要注意：</p>
<h3 id="容器安全"><a href="#容器安全" class="headerlink" title="容器安全"></a>容器安全</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">security_opt:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="literal">no</span><span class="string">-new-privileges:true</span></span><br><span class="line">    <span class="attr">read_only:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tmpfs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>

<h3 id="機密管理"><a href="#機密管理" class="headerlink" title="機密管理"></a>機密管理</h3><p>使用 Docker Secrets：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">api:</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db_password</span></span><br><span class="line"></span><br><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">db_password:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./secrets/db_password.txt</span></span><br></pre></td></tr></table></figure>


<h2 id="最佳實踐建議"><a href="#最佳實踐建議" class="headerlink" title="最佳實踐建議"></a>最佳實踐建議</h2><ol>
<li><p>映像檔優化</p>
<ul>
<li>使用多階段建置減少映像檔大小</li>
<li>善用 .dockerignore 排除不必要檔案</li>
<li>選擇適當的基礎映像檔</li>
</ul>
</li>
<li><p>安全性考量</p>
<ul>
<li>不要在映像檔中存儲敏感資訊</li>
<li>定期更新基礎映像檔</li>
<li>使用非 root 使用者運行容器</li>
</ul>
</li>
<li><p>開發流程</p>
<ul>
<li>使用 docker-compose.override.yml 管理開發環境設定</li>
<li>實作健康檢查機制</li>
<li>建立完整的 CI/CD 流程</li>
</ul>
</li>
</ol>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>透過本文的說明，我們完成了一個完整的 Docker 容器化環境設定，包含了 SQL Server 資料庫、.NET Core API 後端和 Vue3 前端。這樣的架構不僅方便開發和測試，也便於部署和擴展。</p>
<p>記得定期備份資料，並持續優化容器配置以提升效能和安全性。若有任何問題，歡迎參考 Docker 官方文件或社群資源尋求協助。</p>
<h2 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源"></a>參考資源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/">Docker 官方文件</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-tw/sql/linux/quickstart-install-connect-docker">Microsoft SQL Server Docker 指南</a></li>
<li><a target="_blank" rel="noopener" href="https://v3.vuejs.org/guide/deployment.html#docker-nginx">Vue.js Docker 部署指南</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-tw/dotnet/core/docker/build-container">.NET Core Docker 指南</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">SQL 查詢優化案例研究：提升水位監測系統性能</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-08-20 15:38:16" itemprop="dateCreated datePublished" datetime="2024-08-20T15:38:16+08:00">2024-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:34:28" itemprop="dateModified" datetime="2024-11-27T14:34:28+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BC%8F%E6%95%99%E5%AD%B8/" itemprop="url" rel="index"><span itemprop="name">程式教學</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>3.3k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>3 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="SQL-查詢優化案例研究：提升水位監測系統性能"><a href="#SQL-查詢優化案例研究：提升水位監測系統性能" class="headerlink" title="SQL 查詢優化案例研究：提升水位監測系統性能"></a>SQL 查詢優化案例研究：提升水位監測系統性能</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>我們的水位監測系統面臨著一個重要的挑戰：主要的數據查詢速度緩慢，造成了「執行逾時到期。在作業完成之前超過逾時等待的時間，或是伺服器未回應。」的問題，導致系統一直發送LINE通知錯誤。這個案例研究詳細介紹了我們如何通過優化 SQL 查詢來顯著提升系統性能。</p>
<h2 id="初始情況"><a href="#初始情況" class="headerlink" title="初始情況"></a>初始情況</h2><h3 id="系統概況"><a href="#系統概況" class="headerlink" title="系統概況"></a>系統概況</h3><ul>
<li>目前總共有 120 個監測站點（stt_no）</li>
<li>每 10 分鐘向 WaterLevelGaugeHistory 表匯入一次數據</li>
<li>需要查詢每個站點最近 24 小時的最新數據</li>
</ul>
<h3 id="原始查詢"><a href="#原始查詢" class="headerlink" title="原始查詢"></a>原始查詢</h3><p>初始查詢涉及多個表的聯接和子查詢，執行時間約為 1 分鐘以上。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> </span><br><span class="line">    WL.[ID], WL.[stt_name], <span class="comment">/* 其他欄位 ... */</span></span><br><span class="line">    WLH.[measure_time], WLH.[val], WLH.[Status], WLH.cstatus, WLH.[Epower], WLH.nodata</span><br><span class="line"><span class="keyword">FROM</span> [dbo].[WaterLevelGauge] WL</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> [dbo].[WaterLevelGauge_detailed_View] WLD </span><br><span class="line">    <span class="keyword">ON</span> WL.[stt_name] <span class="operator">=</span> WLD.[MonitoringStationNumber]</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> [ID], [stt_no], [dev_id], [measure_time], [val], [Status], [cstatus], [nodata], [power] <span class="keyword">AS</span> Epower, </span><br><span class="line">    <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> [stt_no] <span class="keyword">ORDER</span> <span class="keyword">BY</span> [measure_time] <span class="keyword">DESC</span>) <span class="keyword">AS</span> row_num </span><br><span class="line">    <span class="keyword">FROM</span> [dbo].[WaterLevelGaugeHistory] </span><br><span class="line">    <span class="keyword">WHERE</span> [dev_id] <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">) WLH <span class="keyword">ON</span> WL.[stt_no] <span class="operator">=</span> WLH.[stt_no] <span class="keyword">AND</span> WLH.row_num <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> WL.[memo2] <span class="operator">&lt;&gt;</span> <span class="string">&#x27;停用&#x27;</span> <span class="keyword">OR</span> WL.[memo2] <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="優化過程"><a href="#優化過程" class="headerlink" title="優化過程"></a>優化過程</h2><h3 id="步驟-1：分析查詢瓶頸"><a href="#步驟-1：分析查詢瓶頸" class="headerlink" title="步驟 1：分析查詢瓶頸"></a>步驟 1：分析查詢瓶頸</h3><p>我們發現 WaterLevelGaugeHistory 表的大量數據是造成查詢緩慢的主要原因，觀察的時候已經資料量已經來到了五百萬筆以上。</p>
<h3 id="步驟-2：重構子查詢"><a href="#步驟-2：重構子查詢" class="headerlink" title="步驟 2：重構子查詢"></a>步驟 2：重構子查詢</h3><p>我們重新設計了子查詢，以更高效地過濾和排序數據：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    [ID], [stt_no], [dev_id], [measure_time], [val], [Status], </span><br><span class="line">    [cstatus], [nodata], [power] <span class="keyword">AS</span> Epower</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        [ID], [stt_no], [dev_id], [measure_time], [val], [Status], </span><br><span class="line">        [cstatus], [nodata], [power],</span><br><span class="line">        <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> [stt_no] <span class="keyword">ORDER</span> <span class="keyword">BY</span> [measure_time] <span class="keyword">DESC</span>) <span class="keyword">AS</span> row_num</span><br><span class="line">    <span class="keyword">FROM</span> [dbo].[WaterLevelGaugeHistory]</span><br><span class="line">    <span class="keyword">WHERE</span> [dev_id] <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line">        <span class="keyword">AND</span> [measure_time] <span class="operator">&gt;=</span> DATEADD(<span class="keyword">HOUR</span>, <span class="number">-24</span>, GETDATE())  <span class="comment">-- 只查詢最近24小時的數據</span></span><br><span class="line">) ranked</span><br><span class="line"><span class="keyword">WHERE</span> row_num <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="步驟-3：添加時間過濾"><a href="#步驟-3：添加時間過濾" class="headerlink" title="步驟 3：添加時間過濾"></a>步驟 3：添加時間過濾</h3><p>我們添加了時間過濾條件，只查詢最近 24 小時的數據，這大大減少了需要處理的數據量。</p>
<h3 id="步驟-4：索引優化"><a href="#步驟-4：索引優化" class="headerlink" title="步驟 4：索引優化"></a>步驟 4：索引優化</h3><p>我們創建了一個針對性的索引來支持查詢：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在 WaterLevelGaugeHistory 表上創建優化的複合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> NONCLUSTERED INDEX IX_WaterLevelGaugeHistory_stt_no_measure_time</span><br><span class="line"><span class="keyword">ON</span> [dbo].[WaterLevelGaugeHistory] ([stt_no], [measure_time] <span class="keyword">DESC</span>)</span><br><span class="line">INCLUDE ([val], [Status], [cstatus])</span><br><span class="line"><span class="keyword">WITH</span> (SORT_IN_TEMPDB <span class="operator">=</span> <span class="keyword">ON</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 WaterLevelGauge 表上創建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> NONCLUSTERED INDEX IX_WaterLevelGauge_stt_name</span><br><span class="line"><span class="keyword">ON</span> [dbo].[WaterLevelGauge] ([stt_name])</span><br><span class="line"><span class="keyword">WITH</span> (SORT_IN_TEMPDB <span class="operator">=</span> <span class="keyword">ON</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新統計資訊</span></span><br><span class="line"><span class="keyword">UPDATE</span> STATISTICS [dbo].[WaterLevelGaugeHistory] </span><br><span class="line"><span class="keyword">WITH</span> FULLSCAN;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> STATISTICS [dbo].[WaterLevelGauge] </span><br><span class="line"><span class="keyword">WITH</span> FULLSCAN;</span><br></pre></td></tr></table></figure>

<p>這個索引包含了所有需要的列，支持索引覆蓋查詢，進一步提高了性能。</p>
<h2 id="優化結果"><a href="#優化結果" class="headerlink" title="優化結果"></a>優化結果</h2><p>經過優化後，我們取得了令人矚目的成果：</p>
<ul>
<li><strong>原始查詢時間</strong>：約 1 分鐘</li>
<li><strong>優化後查詢時間</strong>：約 1 秒</li>
<li><strong>性能提升</strong>：超過 98%</li>
</ul>
<p>這種程度的性能改進遠遠超出了我們最初的預期，幾乎達到了即時響應的水平。</p>
<h2 id="深入分析顯著提升的原因"><a href="#深入分析顯著提升的原因" class="headerlink" title="深入分析顯著提升的原因"></a>深入分析顯著提升的原因</h2><ol>
<li><p><strong>精確的數據過濾</strong>：通過限制查詢範圍到最近 24 小時，我們大幅減少了需要處理的數據量。考慮到我們的系統每 10 分鐘更新一次數據，這意味著每個站點最多只需處理 144 條記錄（24小時 * 6次/小時）。</p>
</li>
<li><p><strong>高效的索引利用</strong>：我們創建的複合索引（stt_no, measure_time, dev_id）完美匹配了查詢模式。這使得 SQL Server 能夠快速定位到每個站點的最新記錄，而無需掃描大量數據。</p>
</li>
<li><p><strong>子查詢優化</strong>：重構後的子查詢使用了 ROW_NUMBER() 函數，配合 PARTITION BY 和高效索引，使得 SQL Server 能夠極快地識別每個站點的最新記錄。</p>
</li>
<li><p><strong>索引覆蓋</strong>：通過在索引中包含所有需要的列，我們實現了索引覆蓋查詢。這意味著 SQL Server 可以直接從索引中檢索所有所需的數據，而無需訪問實際的表數據頁，大大減少了 I/O 操作。</p>
</li>
<li><p><strong>數據分布的優勢</strong>：由於我們只有 120 個監測站點，並且每個站點的數據都很規律（每 10 分鐘一條），這種數據分布特性非常有利於查詢優化和索引使用。</p>
</li>
<li><p><strong>減少了複雜的連接操作</strong>：優化後的查詢減少了對 WaterLevelGauge 和 WaterLevelGauge_detailed_View 的連接操作，這些操作在原始查詢中可能造成了額外的性能開銷。</p>
</li>
</ol>
<h2 id="學到的經驗"><a href="#學到的經驗" class="headerlink" title="學到的經驗"></a>學到的經驗</h2><ol>
<li><p><strong>了解數據特性的重要性</strong>：知道有 120 個站點和 10 分鐘的更新頻率，幫助我們做出更精確的優化決策。</p>
</li>
<li><p><strong>時間過濾的效果</strong>：通過只查詢最近 24 小時的數據，大幅減少了需要處理的數據量。</p>
</li>
<li><p><strong>索引設計的重要性</strong>：精心設計的索引可以顯著提升查詢性能。</p>
</li>
<li><p><strong>子查詢優化</strong>：重構子查詢可以更高效地過濾和排序數據。</p>
</li>
<li><p><strong>持續監控和維護的必要性</strong>：建議定期更新統計信息和重建索引，以維持優化效果。</p>
</li>
<li><p><strong>數據特性的重要性</strong>：了解數據的更新頻率、分布特性和查詢模式，對於實現極致的查詢優化至關重要。</p>
</li>
<li><p><strong>不要低估優化的潛力</strong>：有時，經過精心設計的優化可以帶來遠超預期的性能提升。</p>
</li>
<li><p><strong>測試和驗證的重要性</strong>：實際測試結果可能會與理論預期有很大差異，強調了在真實環境中進行全面測試的重要性。</p>
</li>
</ol>
<h2 id="後續建議"><a href="#後續建議" class="headerlink" title="後續建議"></a>後續建議</h2><ol>
<li><p><strong>實施數據保留策略</strong>：考慮只保留最近幾個月的詳細數據，將老數據歸檔或匯總。</p>
</li>
<li><p><strong>定期維護</strong>：設置定期任務來更新統計信息和重建索引。</p>
</li>
<li><p><strong>監控查詢性能</strong>：使用 SQL Server 的查詢存儲持續監控查詢性能，及時發現潛在問題。</p>
</li>
<li><p><strong>考慮進階技術</strong>：如果數據量繼續增長，可能需要考慮分區表或內存優化表等技術。</p>
</li>
<li><p><strong>性能基準測試</strong>：定期進行性能基準測試，以確保優化效果長期保持。</p>
</li>
<li><p><strong>擴展優化範圍</strong>：將類似的優化策略應用到系統中的其他查詢，可能會帶來整體性能的顯著提升。</p>
</li>
<li><p><strong>用戶體驗改進</strong>：利用查詢速度的顯著提升，考慮改進用戶界面，提供更多實時或近實時的數據展示功能。</p>
</li>
</ol>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>這個案例研究展示了深入理解數據特性、精心設計查詢和索引如何帶來變革性的性能提升。將查詢時間從 1 分鐘減少到 1 秒不僅提高了系統效率，還為用戶體驗和未來功能擴展開闢了新的可能性。這種程度的優化證明，即使是看似複雜的性能問題，通過系統的分析和優化，也能夠取得驚人的改進。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">WebSocket教程：構建實時聊天應用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-08-19 18:15:52" itemprop="dateCreated datePublished" datetime="2024-08-19T18:15:52+08:00">2024-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:33:36" itemprop="dateModified" datetime="2024-11-27T14:33:36+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BC%8F%E6%95%99%E5%AD%B8/" itemprop="url" rel="index"><span itemprop="name">程式教學</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>3 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="WebSocket教程：構建實時聊天應用"><a href="#WebSocket教程：構建實時聊天應用" class="headerlink" title="WebSocket教程：構建實時聊天應用"></a>WebSocket教程：構建實時聊天應用</h1><h2 id="目錄"><a href="#目錄" class="headerlink" title="目錄"></a>目錄</h2><ol>
<li>介紹</li>
<li>WebSocket基礎</li>
<li>項目設置</li>
<li>後端實現</li>
<li>前端實現</li>
<li>運行和測試</li>
<li>進階主題</li>
<li>結論</li>
</ol>
<h2 id="1-介紹"><a href="#1-介紹" class="headerlink" title="1. 介紹"></a>1. 介紹</h2><p>在當今的web應用中,實時通信已經成為一個常見需求。無論是聊天應用、協作工具還是實時遊戲,都需要服務器和客戶端之間快速、雙向的通信。WebSocket技術為此提供了完美的解決方案。</p>
<p>在本教程中，我們將深入探討WebSocket技術，並通過構建一個簡單的實時聊天應用來學習如何使用它。我們將使用Python作為後端，JavaScript作為前端。</p>
<h2 id="2-WebSocket基礎"><a href="#2-WebSocket基礎" class="headerlink" title="2. WebSocket基礎"></a>2. WebSocket基礎</h2><p>WebSocket是一種網絡通信協議，提供全雙工通信通道，運行在單個TCP連接上。與傳統的HTTP請求-響應模型不同，WebSocket允許服務器主動向客戶端推送數據。</p>
<p>主要特點：</p>
<ul>
<li>雙向通信</li>
<li>實時數據傳輸</li>
<li>較低的延遲</li>
<li>效率高（相比輪詢）</li>
</ul>
<h2 id="3-項目設置"><a href="#3-項目設置" class="headerlink" title="3. 項目設置"></a>3. 項目設置</h2><h3 id="後端設置"><a href="#後端設置" class="headerlink" title="後端設置"></a>後端設置</h3><ol>
<li>確保已安裝Python (3.7+)</li>
<li>安裝WebSocket庫：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install websockets</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="前端設置"><a href="#前端設置" class="headerlink" title="前端設置"></a>前端設置</h3><p>只需一個簡單的HTML文件和一些JavaScript代碼。</p>
<h2 id="4-後端實現"><a href="#4-後端實現" class="headerlink" title="4. 後端實現"></a>4. 後端實現</h2><p>創建一個名為<code>server.py</code>的文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> websockets</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line"></span><br><span class="line">connected = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">websocket, path</span>):</span><br><span class="line">    client_id = <span class="built_in">id</span>(websocket)</span><br><span class="line">    connected.add(websocket)</span><br><span class="line">    logging.info(<span class="string">f&quot;新客戶端連接: <span class="subst">&#123;client_id&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">for</span> message <span class="keyword">in</span> websocket:</span><br><span class="line">            logging.info(<span class="string">f&quot;收到來自 <span class="subst">&#123;client_id&#125;</span> 的消息: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> conn <span class="keyword">in</span> connected:</span><br><span class="line">                <span class="keyword">if</span> conn != websocket:</span><br><span class="line">                    <span class="keyword">await</span> conn.send(<span class="string">f&quot;用戶 <span class="subst">&#123;client_id&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">                    logging.info(<span class="string">f&quot;消息已發送給客戶端 <span class="subst">&#123;<span class="built_in">id</span>(conn)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        connected.remove(websocket)</span><br><span class="line">        logging.info(<span class="string">f&quot;客戶端斷開連接: <span class="subst">&#123;client_id&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">start_server = websockets.serve(chat, <span class="string">&quot;localhost&quot;</span>, <span class="number">8765</span>)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(start_server)</span><br><span class="line">asyncio.get_event_loop().run_forever()</span><br></pre></td></tr></table></figure>

<p>代碼解釋：</p>
<ul>
<li>我們使用<code>asyncio</code>和<code>websockets</code>庫來創建一個異步WebSocket服務器。</li>
<li><code>connected</code>集合用於存儲所有連接的客戶端。</li>
<li><code>chat</code>函數處理每個WebSocket連接。</li>
<li>當收到消息時，我們將其廣播給所有其他連接的客戶端。</li>
<li>我們使用日志來跟蹤連接、斷開連接和消息傳輸。</li>
</ul>
<h2 id="5-前端實現"><a href="#5-前端實現" class="headerlink" title="5. 前端實現"></a>5. 前端實現</h2><p>創建一個名為<code>index.html</code>的文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket聊天<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#messages</span> &#123; <span class="attribute">height</span>: <span class="number">300px</span>; <span class="attribute">overflow-y</span>: scroll; <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>; <span class="attribute">padding</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.status</span> &#123; <span class="attribute">color</span>: <span class="number">#888</span>; <span class="attribute">font-style</span>: italic; &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.error</span> &#123; <span class="attribute">color</span>: red; &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>WebSocket聊天<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;messages&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;messageInput&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;輸入消息...&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>發送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8765&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> messagesDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;messages&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> messageInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;messageInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addMessage</span>(<span class="string">&#x27;已連接到服務器&#x27;</span>, <span class="string">&#x27;status&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addMessage</span>(event.<span class="property">data</span>, <span class="string">&#x27;message&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="property">onclose</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addMessage</span>(<span class="string">&#x27;與服務器斷開連接&#x27;</span>, <span class="string">&#x27;status&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addMessage</span>(<span class="string">&#x27;WebSocket錯誤: &#x27;</span> + error.<span class="property">message</span>, <span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> message = messageInput.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (message) &#123;</span></span><br><span class="line"><span class="language-javascript">                socket.<span class="title function_">send</span>(message);</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">addMessage</span>(<span class="string">&#x27;你: &#x27;</span> + message, <span class="string">&#x27;message&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                messageInput.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">addMessage</span>(<span class="params">message, type</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> messageElement = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            messageElement.<span class="property">textContent</span> = message;</span></span><br><span class="line"><span class="language-javascript">            messageElement.<span class="property">className</span> = type;</span></span><br><span class="line"><span class="language-javascript">            messagesDiv.<span class="title function_">appendChild</span>(messageElement);</span></span><br><span class="line"><span class="language-javascript">            messagesDiv.<span class="property">scrollTop</span> = messagesDiv.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>代碼解釋：</p>
<ul>
<li>我們創建一個WebSocket連接到我們的服務器。</li>
<li><code>onopen</code>, <code>onmessage</code>, <code>onclose</code>, 和 <code>onerror</code>事件處理程序用於管理WebSocket的生命周期。</li>
<li><code>sendMessage</code>函數用於發送消息到服務器。</li>
<li><code>addMessage</code>函數用於在UI中顯示消息。</li>
</ul>
<h2 id="6-運行和測試"><a href="#6-運行和測試" class="headerlink" title="6. 運行和測試"></a>6. 運行和測試</h2><ol>
<li>啟動服務器：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python server.py</span><br></pre></td></tr></table></figure></li>
<li>在瀏覽器中打開<code>index.html</code>文件。</li>
<li>打開多個瀏覽器窗口或標簽頁來模擬多個用戶。</li>
<li>開始聊天並觀察實時通信！</li>
</ol>
<h2 id="7-進階主題"><a href="#7-進階主題" class="headerlink" title="7. 進階主題"></a>7. 進階主題</h2><ul>
<li>安全性：在生產環境中,考慮使用WSS (WebSocket Secure)。</li>
<li>身份驗證：實現用戶身份驗證系統。</li>
<li>錯誤處理：增強錯誤處理和重連機制。</li>
<li>消息格式：使用JSON等結構化格式傳輸覆雜數據。</li>
<li>擴展性：考慮如何擴展應用以支持更多用戶。</li>
</ul>
<h2 id="8-結論"><a href="#8-結論" class="headerlink" title="8. 結論"></a>8. 結論</h2><p>通過本教程，我們學習了WebSocket的基礎知識，並成功構建了一個簡單的實時聊天應用。WebSocket為實時web應用開發提供了強大的工具，使得創建響應迅速、交互性強的應用成為可能。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">使用 SQL Server Resource Governor 限制特定資料庫的資源使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-08-08 09:36:04" itemprop="dateCreated datePublished" datetime="2024-08-08T09:36:04+08:00">2024-08-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:44:22" itemprop="dateModified" datetime="2024-11-27T14:44:22+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%B3%87%E6%96%99%E5%BA%AB/" itemprop="url" rel="index"><span itemprop="name">資料庫</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>2 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用-SQL-Server-Resource-Governor-限制特定資料庫的資源使用"><a href="#使用-SQL-Server-Resource-Governor-限制特定資料庫的資源使用" class="headerlink" title="使用 SQL Server Resource Governor 限制特定資料庫的資源使用"></a>使用 SQL Server Resource Governor 限制特定資料庫的資源使用</h1><h2 id="1-簡介"><a href="#1-簡介" class="headerlink" title="1. 簡介"></a>1. 簡介</h2><p>某次在正式環境使用者抱怨網頁速度太慢，會卡好幾分鐘，於是開始排查問題，發現自己連接SSMS的搜尋也是一樣卡，不太對勁，結果最後發現了是其他專案資料庫排程執行時過度消耗資源，導致其他專案的效能受到影響，最好的解決方案是應該切其他主機，不過沒有其他資源只能想想其他方法。本文將介紹如何使用 SQL Server 的 Resource Governor 功能來解決這個問題，有效地限制特定資料庫的資源使用。</p>
<h2 id="2-Resource-Governor-簡介"><a href="#2-Resource-Governor-簡介" class="headerlink" title="2. Resource Governor 簡介"></a>2. Resource Governor 簡介</h2><p>Resource Governor 是 SQL Server 提供的一個強大工具，用於管理 SQL Server 實例中的工作負載和資源消耗。它允許我們為不同的工作負載設置資源使用限制，確保關鍵任務能夠獲得所需的資源。</p>
<p>相比其他方法（如設置 MAXDOP），Resource Governor 提供了更細緻和動態的控制，能夠根據多種條件（如資料庫名稱、登入帳號等）來分配資源。</p>
<h2 id="3-設定-Resource-Governor-的步驟"><a href="#3-設定-Resource-Governor-的步驟" class="headerlink" title="3. 設定 Resource Governor 的步驟"></a>3. 設定 Resource Governor 的步驟</h2><h3 id="3-1-建立資源池-Resource-Pool"><a href="#3-1-建立資源池-Resource-Pool" class="headerlink" title="3.1 建立資源池 (Resource Pool)"></a>3.1 建立資源池 (Resource Pool)</h3><p>資源池定義了可用的資源限制。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> RESOURCE POOL PoolAdhocDB</span><br><span class="line"><span class="keyword">WITH</span> (MAX_CPU_PERCENT <span class="operator">=</span> <span class="number">20</span>, </span><br><span class="line">      MAX_MEMORY_PERCENT <span class="operator">=</span> <span class="number">25</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-2-建立工作負載群組-Workload-Group"><a href="#3-2-建立工作負載群組-Workload-Group" class="headerlink" title="3.2 建立工作負載群組 (Workload Group)"></a>3.2 建立工作負載群組 (Workload Group)</h3><p>工作負載群組關聯到特定的資源池。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> WORKLOAD <span class="keyword">GROUP</span> GroupAdhocDB</span><br><span class="line"><span class="keyword">USING</span> PoolAdhocDB;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-建立分類函數-Classifier-Function"><a href="#3-3-建立分類函數-Classifier-Function" class="headerlink" title="3.3 建立分類函數 (Classifier Function)"></a>3.3 建立分類函數 (Classifier Function)</h3><p>分類函數決定將請求分配到哪個工作負載群組。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">USE master;</span><br><span class="line">GO</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> dbo.fn_WorkloadClassifier()</span><br><span class="line"><span class="keyword">RETURNS</span> sysname </span><br><span class="line"><span class="keyword">WITH</span> SCHEMABINDING</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">RETURN</span> <span class="keyword">CASE</span> </span><br><span class="line">               <span class="keyword">WHEN</span> DB_NAME() <span class="operator">=</span> <span class="string">&#x27;AdhocDatabase&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;GroupAdhocDB&#x27;</span></span><br><span class="line">               <span class="keyword">ELSE</span> <span class="string">&#x27;default&#x27;</span></span><br><span class="line">           <span class="keyword">END</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<h3 id="3-4-啟用-Resource-Governor-設定"><a href="#3-4-啟用-Resource-Governor-設定" class="headerlink" title="3.4 啟用 Resource Governor 設定"></a>3.4 啟用 Resource Governor 設定</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> RESOURCE GOVERNOR <span class="keyword">WITH</span> (CLASSIFIER_FUNCTION <span class="operator">=</span> dbo.fn_WorkloadClassifier);</span><br><span class="line"><span class="keyword">ALTER</span> RESOURCE GOVERNOR RECONFIGURE;</span><br></pre></td></tr></table></figure>

<h2 id="4-驗證設定"><a href="#4-驗證設定" class="headerlink" title="4. 驗證設定"></a>4. 驗證設定</h2><p>執行以下查詢來檢查 Resource Governor 的組態：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.resource_governor_configuration;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.resource_governor_resource_pools;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.resource_governor_workload_groups;</span><br></pre></td></tr></table></figure>

<h2 id="5-注意事項"><a href="#5-注意事項" class="headerlink" title="5. 注意事項"></a>5. 注意事項</h2><ul>
<li>確保在 master 資料庫中創建分類函數</li>
<li>確保有足夠的權限（通常需要 CONTROL SERVER 權限）</li>
<li>根據實際情況調整資源池的限制參數</li>
</ul>
<h2 id="6-可能遇到的問題與解決方案"><a href="#6-可能遇到的問題與解決方案" class="headerlink" title="6. 可能遇到的問題與解決方案"></a>6. 可能遇到的問題與解決方案</h2><ol>
<li>分類函數找不到的錯誤<ul>
<li>解決方案：確保函數名稱正確，且存在於 master 資料庫中</li>
</ul>
</li>
<li>權限不足的問題<ul>
<li>解決方案：確保執行組態的帳號具有足夠的權限</li>
</ul>
</li>
</ol>
<h2 id="7-優化建議"><a href="#7-優化建議" class="headerlink" title="7. 優化建議"></a>7. 優化建議</h2><ul>
<li>定期監控資源使用情況，可以使用 Dynamic Management Views (DMVs) 來追蹤資源使用</li>
<li>根據監控結果調整資源池設定，確保資源分配合理</li>
</ul>
<h2 id="8-總結"><a href="#8-總結" class="headerlink" title="8. 總結"></a>8. 總結</h2><p>Resource Governor 為我們提供了一個強大的工具，用於管理 SQL Server 的資源分配。通過合理組態，我們可以：</p>
<ul>
<li>防止單一資料庫過度消耗資源</li>
<li>確保關鍵業務的效能</li>
<li>提高整體資料庫伺服器的穩定性和可預測性</li>
</ul>
<p>在複雜的多租戶或多應用環境中，Resource Governor 的使用尤為重要，它能夠幫助 DBA 更好地平衡各種工作負載的需求。</p>
<h2 id="9-延伸閱讀"><a href="#9-延伸閱讀" class="headerlink" title="9. 延伸閱讀"></a>9. 延伸閱讀</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sql/relational-databases/resource-governor/resource-governor">SQL Server 官方文檔：Resource Governor</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sql/relational-databases/performance/monitor-resource-usage-system-statistical-functions">使用 Extended Events 監控 Resource Governor</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sql/relational-databases/performance/performance-center-for-sql-server-database-engine-and-azure-sql-database">其他 SQL Server 效能優化技巧</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">深入解析:使用Python構建全面的市場風險監測工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-08-06 13:58:22" itemprop="dateCreated datePublished" datetime="2024-08-06T13:58:22+08:00">2024-08-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:43:08" itemprop="dateModified" datetime="2024-11-27T14:43:08+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BC%8F%E9%96%8B%E7%99%BC/" itemprop="url" rel="index"><span itemprop="name">程式開發</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>2.7k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>2 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kyosora/VolatilityVigil">專案網址</a></li>
</ul>
<h1 id="深入解析-使用Python構建全面的市場風險監測工具"><a href="#深入解析-使用Python構建全面的市場風險監測工具" class="headerlink" title="深入解析:使用Python構建全面的市場風險監測工具"></a>深入解析:使用Python構建全面的市場風險監測工具</h1><p>七月的時候因為許多的利空事件極短時間內發生，結果全球股災，來的速度太快結果都被套牢了，所以想著開發一個使用Python市場風險監測工具，該工具能夠分析多個市場指標，計算風險評分，並提供直觀的視覺化結果。</p>
<h2 id="1-程式概述"><a href="#1-程式概述" class="headerlink" title="1. 程式概述"></a>1. 程式概述</h2><p>這個Python程式主要實現以下功能:</p>
<ul>
<li>從Yahoo Finance獲取多個市場的歷史數據</li>
<li>計算各市場的波動性和異常情況</li>
<li>基於波動性和異常情況評估市場風險</li>
<li>使用機器學習方法對市場狀態進行聚類</li>
<li>生成多種視覺化圖表以直觀展示分析結果</li>
</ul>
<p>程式使用了多個Python庫，包括pandas用於數據處理，sklearn用於機器學習算法，yfinance用於獲取市場數據，以及matplotlib和seaborn用於數據可視化。</p>
<h2 id="2-核心功能詳解"><a href="#2-核心功能詳解" class="headerlink" title="2. 核心功能詳解"></a>2. 核心功能詳解</h2><h3 id="2-1-數據獲取"><a href="#2-1-數據獲取" class="headerlink" title="2.1 數據獲取"></a>2.1 數據獲取</h3><p>程式使用<code>yfinance</code>庫從Yahoo Finance獲取過去90天的市場數據:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_date_range</span>():</span><br><span class="line">    end_date = datetime.now().date()</span><br><span class="line">    start_date = end_date - timedelta(days=<span class="number">90</span>)</span><br><span class="line">    <span class="keyword">return</span> start_date， end_date</span><br><span class="line"></span><br><span class="line">market_data = yf.download(symbols， start=start_date， end=end_date)[<span class="string">&#x27;Close&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>這裡的<code>symbols</code>列表包含了多個市場指標，涵蓋美國、歐洲、亞洲的主要股市指數，以及商品期貨和外匯市場。</p>
<h3 id="2-2-風險評估"><a href="#2-2-風險評估" class="headerlink" title="2.2 風險評估"></a>2.2 風險評估</h3><p>風險評估主要基於兩個因素:波動性和異常情況。</p>
<p>波動性計算:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_volatility</span>(<span class="params">data， window=<span class="number">20</span></span>):</span><br><span class="line">    <span class="keyword">return</span> data.pct_change().rolling(window=window).std() * np.sqrt(<span class="number">252</span>)</span><br></pre></td></tr></table></figure>

<p>異常檢測使用PCA(主成分分析)方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">detect_anomalies</span>(<span class="params">data， threshold=<span class="number">3</span></span>):</span><br><span class="line">    <span class="comment"># ... (代碼省略)</span></span><br><span class="line">    pca = PCA(n_components=<span class="number">0.95</span>)</span><br><span class="line">    pca_result = pca.fit_transform(normalized_data)</span><br><span class="line">    reconstruction = pca.inverse_transform(pca_result)</span><br><span class="line">    mse = np.mean(np.power(normalized_data - reconstruction， <span class="number">2</span>)， axis=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> pd.Series(mse &gt; threshold * np.std(mse)， index=data.index)</span><br></pre></td></tr></table></figure>

<p>風險評分的計算綜合考慮了波動性和異常情況:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_risk_score</span>(<span class="params">market_data</span>):</span><br><span class="line">    volatility = calculate_volatility(market_data)</span><br><span class="line">    anomalies = detect_anomalies(market_data)</span><br><span class="line">    </span><br><span class="line">    risk_score = pd.DataFrame(index=common_index)</span><br><span class="line">    <span class="keyword">for</span> column <span class="keyword">in</span> market_data.columns:</span><br><span class="line">        vol_threshold = volatility[column].mean() + <span class="number">2</span> * volatility[column].std()</span><br><span class="line">        risk_score[column] = anomalies.astype(<span class="built_in">int</span>) + (volatility[column] &gt; vol_threshold).astype(<span class="built_in">int</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> risk_score</span><br></pre></td></tr></table></figure>

<h3 id="2-3-市場狀態聚類"><a href="#2-3-市場狀態聚類" class="headerlink" title="2.3 市場狀態聚類"></a>2.3 市場狀態聚類</h3><p>程式使用K-means算法對市場狀態進行聚類:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cluster_market_states</span>(<span class="params">data， n_clusters=<span class="number">5</span></span>):</span><br><span class="line">    kmeans = KMeans(n_clusters=n_clusters， n_init=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">return</span> pd.Series(kmeans.fit_predict(data_filled)， index=data.index)</span><br></pre></td></tr></table></figure>

<p>這有助於識別市場的不同運行狀態，為投資決策提供額外的參考。</p>
<h2 id="3-視覺化"><a href="#3-視覺化" class="headerlink" title="3. 視覺化"></a>3. 視覺化</h2><p>程式提供了多種視覺化方法，幫助更直觀地理解分析結果:</p>
<ol>
<li>風險評分熱力圖</li>
<li>市場趨勢圖</li>
<li>市場相關性矩陣</li>
<li>總體風險評分分佈圖</li>
</ol>
<p>這些視覺化功能使用matplotlib和seaborn庫實現，例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_risk_scores</span>(<span class="params">risk_score</span>):</span><br><span class="line">    plt.figure(figsize=(<span class="number">12</span>， <span class="number">6</span>))</span><br><span class="line">    sns.heatmap(risk_score.T， cmap=<span class="string">&#x27;YlOrRd&#x27;</span>， cbar_kws=&#123;<span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;風險評分&#x27;</span>&#125;)</span><br><span class="line">    plt.title(<span class="string">&#x27;各市場風險評分熱力圖&#x27;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;日期&#x27;</span>)</span><br><span class="line">    plt.ylabel(<span class="string">&#x27;市場&#x27;</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="4-結果解釋"><a href="#4-結果解釋" class="headerlink" title="4. 結果解釋"></a>4. 結果解釋</h2><p>程式不僅提供數值結果，還包含了詳細的結果解釋功能:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">explain_risk_score</span>(<span class="params">risk_score</span>):</span><br><span class="line">    explanations = &#123;</span><br><span class="line">        <span class="number">0</span>: <span class="string">&quot;低風險：市場表現正常，波動性低於平均水平。&quot;</span>，</span><br><span class="line">        <span class="number">1</span>: <span class="string">&quot;中等風險：市場出現一些異常波動或波動性略高於平均水平。需要密切關注。&quot;</span>，</span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;高風險：市場出現顯著異常或波動性大幅高於平均水平。建議採取風險管理措施。&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># ... (代碼省略)</span></span><br></pre></td></tr></table></figure>

<p>這個功能將數值結果轉化為易於理解的文字描述，並針對高風險市場提供特別警示。</p>
<h2 id="5-使用注意事項"><a href="#5-使用注意事項" class="headerlink" title="5. 使用注意事項"></a>5. 使用注意事項</h2><ol>
<li>資料時效性:程式會檢查最新數據的日期，如果距離當前日期超過5天，會發出警告。</li>
<li>缺失數據處理:程式會報告並處理缺失數據，使用前向填充和後向填充方法。</li>
<li>市場休市:用戶需要注意解釋結果時考慮市場休市等因素。</li>
</ol>
<h2 id="6-結論"><a href="#6-結論" class="headerlink" title="6. 結論"></a>6. 結論</h2><p>這個Python程式提供了一個全面的市場風險監測解決方案。它不僅能夠及時評估多個市場的風險狀況，還提供了直觀的視覺化結果和詳細的解釋。這對於投資者、風險管理人員和市場分析師來說都是一個非常有價值的工具。</p>
<p>然而，需要注意的是，任何模型都有其局限性。這個工具應該作為決策的輔助，而不是唯一依據。使用者仍需結合其他分析方法和專業判斷來做出投資決策。</p>
<p>未來，這個工具還可以進一步擴展，例如風險預警系統、納入更多的市場指標，引入更復雜的機器學習模型，或者開發成為一個實時監測系統。隨著金融市場的不斷演變，持續優化和更新這樣的風險監測工具將變得越來越重要。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">為什麼你應該使用Docker？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-07-14 17:50:09" itemprop="dateCreated datePublished" datetime="2024-07-14T17:50:09+08:00">2024-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:46:42" itemprop="dateModified" datetime="2024-11-27T14:46:42+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%96%8B%E7%99%BC%E7%9B%B8%E9%97%9C/" itemprop="url" rel="index"><span itemprop="name">開發相關</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>1 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="為什麼你應該使用Docker？"><a href="#為什麼你應該使用Docker？" class="headerlink" title="為什麼你應該使用Docker？"></a>為什麼你應該使用Docker？</h1><p>在現代軟體開發和部署領域中,Docker已經成為一個不可或缺的工具。無論你是開發人員、系統管理員,還是 DevOps 工程師,了解並使用Docker都能為你的工作帶來諸多好處。本文將深入探討為什麼你應該開始使用Docker,以及它能為你的專案和工作流程帶來哪些優勢。</p>
<h2 id="1-一致的開發環境"><a href="#1-一致的開發環境" class="headerlink" title="1. 一致的開發環境"></a>1. 一致的開發環境</h2><p>Docker 最顯著的優勢之一就是能夠創建一致的開發環境。通過使用Docker,你可以確保所有開發人員都在相同的環境中工作,無論他們使用的是什麼操作系統。</p>
<ul>
<li><strong>消除「在我的機器上可以運行」的問題:</strong> Docker容器封裝了應用程式及其所有依賴,確保它在任何地方都能以相同的方式運行。</li>
<li><strong>簡化新成員入職:</strong> 新加入的團隊成員可以快速設置開發環境,無需花費大量時間進行配置。</li>
<li><strong>版本控制環境:</strong> 你可以輕鬆管理不同版本的開發環境,便於在不同專案間切換。</li>
</ul>
<h2 id="2-提高部署效率"><a href="#2-提高部署效率" class="headerlink" title="2. 提高部署效率"></a>2. 提高部署效率</h2><p>Docker 極大地簡化了應用程式的部署流程,使得從開發到生產環境的遷移變得更加順暢。</p>
<ul>
<li><strong>快速部署:</strong> Docker 映像檔可以在幾秒鐘內啟動,大大縮短了部署時間。</li>
<li><strong>可移植性:</strong> Docker 容器可以在任何支援 Docker 的系統上運行,無需擔心底層基礎設施的差異。</li>
<li><strong>擴展性:</strong> 使用 Docker Swarm 或 Kubernetes 等工具,你可以輕鬆實現應用程式的水平擴展。</li>
</ul>
<h2 id="3-資源效率"><a href="#3-資源效率" class="headerlink" title="3. 資源效率"></a>3. 資源效率</h2><p>相較於傳統的虛擬機,Docker容器更加輕量級,能夠更有效地利用系統資源。</p>
<ul>
<li><strong>共享作業系統核心:</strong> 多個容器可以共享同一個作業系統核心,減少了額外的開銷。</li>
<li><strong>快速啟動:</strong> 容器可以在幾毫秒內啟動,遠快於傳統虛擬機。</li>
<li><strong>高密度部署:</strong> 在同一台主機上可以運行更多的容器,提高了硬體利用率。</li>
</ul>
<h2 id="4-隔離性和安全性"><a href="#4-隔離性和安全性" class="headerlink" title="4. 隔離性和安全性"></a>4. 隔離性和安全性</h2><p>Docker 提供了一個隔離的環境來運行應用程式,增強了系統的整體安全性。</p>
<ul>
<li><strong>應用程式隔離:</strong> 每個容器都在自己的沙箱中運行,減少了應用程式之間相互影響的風險。</li>
<li><strong>資源限制:</strong> 可以為每個容器設置資源使用限制,防止單個容器消耗過多資源。</li>
<li><strong>版本控制:</strong> 容易追蹤和管理不同版本的應用程式,便於回滾和版本管理。</li>
</ul>
<h2 id="5-簡化微服務架構的實現"><a href="#5-簡化微服務架構的實現" class="headerlink" title="5. 簡化微服務架構的實現"></a>5. 簡化微服務架構的實現</h2><p>對於採用微服務架構的專案,Docker 提供了理想的容器化解決方案。</p>
<ul>
<li><strong>服務獨立性:</strong> 每個微服務可以獨立部署在自己的容器中,便於管理和擴展。</li>
<li><strong>快速迭代:</strong> 可以單獨更新和部署特定的微服務,而不影響整個系統。</li>
<li><strong>技術多樣性:</strong> 不同的微服務可以使用不同的技術棧,每個都封裝在自己的容器中。</li>
</ul>
<h2 id="6-便於持續集成和持續部署-CI-CD"><a href="#6-便於持續集成和持續部署-CI-CD" class="headerlink" title="6. 便於持續集成和持續部署 (CI/CD)"></a>6. 便於持續集成和持續部署 (CI/CD)</h2><p>Docker 與現代 CI/CD 工具完美集成,簡化了自動化測試和部署流程。</p>
<ul>
<li><strong>一致的測試環境:</strong> 確保測試總是在與生產環境相同的條件下進行。</li>
<li><strong>快速構建和部署:</strong> 容器化應用程式可以快速構建、測試和部署。</li>
<li><strong>容易回滾:</strong> 如果新版本出現問題,可以迅速回滾到之前的穩定版本。</li>
</ul>
<h2 id="7-支援雲端遷移和混合雲"><a href="#7-支援雲端遷移和混合雲" class="headerlink" title="7. 支援雲端遷移和混合雲"></a>7. 支援雲端遷移和混合雲</h2><p>Docker 使得在不同雲端平台之間遷移應用程式變得更加容易。</p>
<ul>
<li><strong>雲端無關性:</strong> Docker 容器可以在任何支援 Docker 的雲端平台上運行。</li>
<li><strong>混合雲支援:</strong> 可以輕鬆在私有雲和公有雲之間遷移應用程式。</li>
<li><strong>多雲戰略:</strong> 便於實施多雲戰略,避免對單一雲端提供商的依賴。</li>
</ul>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>Docker 已經徹底改變了我們開發、測試和部署應用程式的方式。它不僅提高了效率和一致性,還為現代軟體開發中的許多挑戰提供了解決方案。無論是簡化開發環境、提高部署效率,還是支援微服務架構和 CI/CD 流程,Docker 都展現出了巨大的優勢。</p>
<p>對於任何希望提高生產力、增強應用程式可移植性和擴展性的團隊來說,學習和採用Docker都是一個明智之選。隨著容器技術的不斷發展,Docker 無疑將繼續在軟體開發和部署領域扮演重要角色。現在正是開始使用Docker的最佳時機,讓它成為你技術工具箱中的一個強大工具吧!</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">從Newtonsoft.Json遷移到System.Text.Json的經驗分享</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-06-27 18:43:20" itemprop="dateCreated datePublished" datetime="2024-06-27T18:43:20+08:00">2024-06-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-12-10 09:57:30" itemprop="dateModified" datetime="2024-12-10T09:57:30+08:00">2024-12-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BC%8F%E6%95%99%E5%AD%B8/" itemprop="url" rel="index"><span itemprop="name">程式教學</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>1 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="從Newtonsoft-Json遷移到System-Text-Json的經驗分享"><a href="#從Newtonsoft-Json遷移到System-Text-Json的經驗分享" class="headerlink" title="從Newtonsoft.Json遷移到System.Text.Json的經驗分享"></a>從Newtonsoft.Json遷移到System.Text.Json的經驗分享</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在.NET Core的發展過程中，微軟推出了System.Text.Json作為內建的JSON處理庫，以替代長期以來廣泛使用的Newtonsoft.Json (也稱為Json.NET)。本文將分享我在從Newtonsoft.Json遷移到System.Text.Json過程中的經驗，特別是一些可能遇到的&quot;坑&quot;以及解決方案。</p>
<h2 id="為什麼要遷移"><a href="#為什麼要遷移" class="headerlink" title="為什麼要遷移?"></a>為什麼要遷移?</h2><ul>
<li>System.Text.Json的優勢<ul>
<li>更好的性能</li>
<li>與.NET Core的深度整合</li>
<li>減少外部依賴</li>
</ul>
</li>
</ul>
<h2 id="主要差異"><a href="#主要差異" class="headerlink" title="主要差異"></a>主要差異</h2><ol>
<li>命名策略</li>
<li>日期時間處理</li>
<li>類型處理和多態性</li>
<li>循環引用</li>
</ol>
<h2 id="遇到的問題-JSON輸出變成小駝峰命名"><a href="#遇到的問題-JSON輸出變成小駝峰命名" class="headerlink" title="遇到的問題:JSON輸出變成小駝峰命名"></a>遇到的問題:JSON輸出變成小駝峰命名</h2><h3 id="問題描述"><a href="#問題描述" class="headerlink" title="問題描述"></a>問題描述</h3><p>在遷移過程中，我驚訝地發現原本使用Pascal命名法(大駝峰)的JSON輸出突然變成了Camel命名法(小駝峰)。這是因為System.Text.Json和Newtonsoft.Json在默認命名策略上的差異。</p>
<h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><ul>
<li>Newtonsoft.Json默認保持屬性名稱不變</li>
<li>System.Text.Json默認使用Camel命名法</li>
</ul>
<h3 id="解決方案"><a href="#解決方案" class="headerlink" title="解決方案"></a>解決方案</h3><p>要解決這個問題，我們可以在配置System.Text.Json序列化選項時指定命名策略:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Text.Json;</span><br><span class="line"><span class="keyword">using</span> System.Text.Json.Serialization;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = <span class="keyword">new</span> JsonSerializerOptions</span><br><span class="line">&#123;</span><br><span class="line">    PropertyNamingPolicy = <span class="literal">null</span> <span class="comment">// 使用此設置保持原始屬性名稱</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用選項進行序列化</span></span><br><span class="line"><span class="built_in">string</span> json = JsonSerializer.Serialize(myObject, options);</span><br></pre></td></tr></table></figure>

<h2 id="其他常見問題及解決方案"><a href="#其他常見問題及解決方案" class="headerlink" title="其他常見問題及解決方案"></a>其他常見問題及解決方案</h2><h3 id="1-日期時間格式"><a href="#1-日期時間格式" class="headerlink" title="1. 日期時間格式"></a>1. 日期時間格式</h3><p>System.Text.Json默認使用ISO 8601格式，而Newtonsoft.Json允許更多自定義。</p>
<p>解決方案:使用自定義的JsonConverter</p>
<h3 id="2-處理null值"><a href="#2-處理null值" class="headerlink" title="2. 處理null值"></a>2. 處理null值</h3><p>System.Text.Json默認不序列化null值，而Newtonsoft.Json會。</p>
<p>解決方案:設置<code>JsonSerializerOptions.DefaultIgnoreCondition</code></p>
<h3 id="3-類型處理和多態性"><a href="#3-類型處理和多態性" class="headerlink" title="3. 類型處理和多態性"></a>3. 類型處理和多態性</h3><p>System.Text.Json在處理複雜類型和多態性時不如Newtonsoft.Json靈活。</p>
<p>解決方案:使用自定義JsonConverter或考慮保留Newtonsoft.Json用於複雜場景</p>
<h2 id="遷移步驟"><a href="#遷移步驟" class="headerlink" title="遷移步驟"></a>遷移步驟</h2><ol>
<li>評估當前使用情況</li>
<li>更新包引用</li>
<li>修改序列化和反序列化代碼</li>
<li>處理命名策略</li>
<li>調整日期時間處理</li>
<li>處理自定義轉換器</li>
<li>測試和驗證</li>
</ol>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>從Newtonsoft.Json遷移到System.Text.Json雖然可能遇到一些挑戰，但通過適當的配置和調整，大多數問題都可以得到解決。遷移帶來的性能提升和與.NET Core的更好集成是值得的。然而，對於一些特別複雜的場景，可能需要考慮混合使用兩個庫或暫時保留Newtonsoft.Json。</p>
<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/system-text-json-migrate-from-newtonsoft-how-to">Microsoft Docs: How to migrate from Newtonsoft.Json to System.Text.Json</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dotnet/runtime/tree/main/src/libraries/System.Text.Json">System.Text.Json GitHub Repository</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">System.Text.Json 與 Newtonsoft.Json 的深入比較</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-06-26 18:51:01" itemprop="dateCreated datePublished" datetime="2024-06-26T18:51:01+08:00">2024-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:39:42" itemprop="dateModified" datetime="2024-11-27T14:39:42+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BC%8F%E6%95%99%E5%AD%B8/" itemprop="url" rel="index"><span itemprop="name">程式教學</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>3 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="System-Text-Json-與-Newtonsoft-Json-的深入比較"><a href="#System-Text-Json-與-Newtonsoft-Json-的深入比較" class="headerlink" title="System.Text.Json 與 Newtonsoft.Json 的深入比較"></a>System.Text.Json 與 Newtonsoft.Json 的深入比較</h1><p>上一篇文章提到，從Newtonsoft.Json遷移到System.Text.Json的經驗分享，這一篇講講兩個之間的比較，在.NET開發生態系統中，JSON序列化是一個常見的需求。本文將深入比較兩個主要的JSON序列化工具：較新的System.Text.Json和經典的Newtonsoft.Json（也稱為Json.NET）。</p>
<h2 id="歷史背景"><a href="#歷史背景" class="headerlink" title="歷史背景"></a>歷史背景</h2><h3 id="Newtonsoft-Json"><a href="#Newtonsoft-Json" class="headerlink" title="Newtonsoft.Json"></a>Newtonsoft.Json</h3><ul>
<li>2007年發布</li>
<li>長期作為.NET生態系統的標準JSON處理工具</li>
<li>在.NET Framework時期被廣泛使用</li>
<li>直到.NET Core 2.x都是預設的JSON序列化器</li>
</ul>
<h3 id="System-Text-Json"><a href="#System-Text-Json" class="headerlink" title="System.Text.Json"></a>System.Text.Json</h3><ul>
<li>隨著.NET Core 3.0（2019年）推出</li>
<li>由微軟開發，作為.NET Core的一部分</li>
<li>設計目標是提供更好的效能和更低的資源使用</li>
</ul>
<h2 id="效能比較"><a href="#效能比較" class="headerlink" title="效能比較"></a>效能比較</h2><h3 id="System-Text-Json-優勢"><a href="#System-Text-Json-優勢" class="headerlink" title="System.Text.Json 優勢"></a>System.Text.Json 優勢</h3><ul>
<li>序列化和反序列化速度更快</li>
<li>更低的記憶體使用量</li>
<li>減少垃圾回收的頻率</li>
<li>特別適合處理大型JSON數據</li>
<li>非同步處理的效能更好</li>
</ul>
<h3 id="實際數據（以處理1MB-JSON檔案為例）"><a href="#實際數據（以處理1MB-JSON檔案為例）" class="headerlink" title="實際數據（以處理1MB JSON檔案為例）"></a>實際數據（以處理1MB JSON檔案為例）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">序列化速度：</span><br><span class="line">- System.Text.Json: ~45ms</span><br><span class="line">- Newtonsoft.Json: ~65ms</span><br><span class="line"></span><br><span class="line">記憶體使用：</span><br><span class="line">- System.Text.Json: ~30MB</span><br><span class="line">- Newtonsoft.Json: ~45MB</span><br></pre></td></tr></table></figure>

<h2 id="功能比較"><a href="#功能比較" class="headerlink" title="功能比較"></a>功能比較</h2><h3 id="Newtonsoft-Json-優勢"><a href="#Newtonsoft-Json-優勢" class="headerlink" title="Newtonsoft.Json 優勢"></a>Newtonsoft.Json 優勢</h3><ol>
<li><p>功能完整性</p>
<ul>
<li>支援更多的序列化選項</li>
<li>提供更豐富的自訂設定</li>
<li>更好的動態型別支援</li>
<li>完整的LINQ to JSON支援</li>
</ul>
</li>
<li><p>彈性</p>
<ul>
<li>更多的特性（Attributes）選項</li>
<li>更容易處理複雜的JSON結構</li>
<li>更好的日期格式處理</li>
<li>支援更多的資料型別轉換</li>
</ul>
</li>
<li><p>成熟度</p>
<ul>
<li>大量的社群支援</li>
<li>豐富的文件和範例</li>
<li>經過長期實戰測試</li>
</ul>
</li>
</ol>
<h3 id="System-Text-Json-優勢-1"><a href="#System-Text-Json-優勢-1" class="headerlink" title="System.Text.Json 優勢"></a>System.Text.Json 優勢</h3><ol>
<li><p>安全性</p>
<ul>
<li>預設的安全設定更嚴格</li>
<li>內建防止JSON反序列化攻擊的機制</li>
<li>限制JSON物件的巢狀深度</li>
</ul>
</li>
<li><p>現代化設計</p>
<ul>
<li>支援新的.NET功能</li>
<li>更好的跨平台支援</li>
<li>原生支援非同步操作</li>
</ul>
</li>
</ol>
<h2 id="程式碼比較"><a href="#程式碼比較" class="headerlink" title="程式碼比較"></a>程式碼比較</h2><h3 id="基本序列化"><a href="#基本序列化" class="headerlink" title="基本序列化"></a>基本序列化</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// System.Text.Json</span></span><br><span class="line"><span class="keyword">using</span> System.Text.Json;</span><br><span class="line"><span class="keyword">var</span> json = JsonSerializer.Serialize(myObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Newtonsoft.Json</span></span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"><span class="keyword">var</span> json = JsonConvert.SerializeObject(myObject);</span><br></pre></td></tr></table></figure>

<h3 id="自訂命名規則"><a href="#自訂命名規則" class="headerlink" title="自訂命名規則"></a>自訂命名規則</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// System.Text.Json</span></span><br><span class="line"><span class="keyword">using</span> System.Text.Json;</span><br><span class="line"></span><br><span class="line">options.PropertyNamingPolicy = JsonNamingPolicy.CamelCase;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Newtonsoft.Json</span></span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"></span><br><span class="line">settings.ContractResolver = <span class="keyword">new</span> CamelCasePropertyNamesContractResolver();</span><br></pre></td></tr></table></figure>

<h2 id="使用建議"><a href="#使用建議" class="headerlink" title="使用建議"></a>使用建議</h2><h3 id="適合使用System-Text-Json的情況"><a href="#適合使用System-Text-Json的情況" class="headerlink" title="適合使用System.Text.Json的情況"></a>適合使用System.Text.Json的情況</h3><ol>
<li>新專案開發</li>
<li>需要較高效能</li>
<li>主要處理簡單的JSON結構</li>
<li>使用.NET Core/.NET 5+的新專案</li>
<li>需要較低資源使用</li>
</ol>
<h3 id="適合使用Newtonsoft-Json的情況"><a href="#適合使用Newtonsoft-Json的情況" class="headerlink" title="適合使用Newtonsoft.Json的情況"></a>適合使用Newtonsoft.Json的情況</h3><ol>
<li>維護現有專案</li>
<li>需要特定的JSON處理功能</li>
<li>處理複雜的JSON結構</li>
<li>需要大量自訂序列化邏輯</li>
<li>團隊較熟悉Newtonsoft.Json</li>
</ol>
<h2 id="實際應用範例"><a href="#實際應用範例" class="headerlink" title="實際應用範例"></a>實際應用範例</h2><h3 id="處理動態物件"><a href="#處理動態物件" class="headerlink" title="處理動態物件"></a>處理動態物件</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// System.Text.Json</span></span><br><span class="line"><span class="keyword">using</span> System.Text.Json.Nodes;</span><br><span class="line"><span class="keyword">var</span> jsonNode = JsonNode.Parse(jsonString);</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">value</span> = jsonNode[<span class="string">&quot;property&quot;</span>].GetValue&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Newtonsoft.Json</span></span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json.Linq;</span><br><span class="line"><span class="keyword">var</span> jObject = JObject.Parse(jsonString);</span><br><span class="line"><span class="keyword">var</span> <span class="keyword">value</span> = jObject[<span class="string">&quot;property&quot;</span>].Value&lt;<span class="built_in">string</span>&gt;();</span><br></pre></td></tr></table></figure>

<h3 id="自訂型別轉換"><a href="#自訂型別轉換" class="headerlink" title="自訂型別轉換"></a>自訂型別轉換</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// System.Text.Json</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomConverter</span> : <span class="title">JsonConverter</span>&lt;<span class="title">CustomType</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> CustomType <span class="title">Read</span>(<span class="params"><span class="keyword">ref</span> Utf8JsonReader reader,</span></span></span><br><span class="line"><span class="params"><span class="function">        Type typeToConvert,</span></span></span><br><span class="line"><span class="params"><span class="function">        JsonSerializerOptions options</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 實作讀取邏輯</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Write</span>(<span class="params">Utf8JsonWriter writer,</span></span></span><br><span class="line"><span class="params"><span class="function">        CustomType <span class="keyword">value</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        JsonSerializerOptions options</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 實作寫入邏輯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Newtonsoft.Json</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomConverter</span> : <span class="title">JsonConverter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">object</span> <span class="title">ReadJson</span>(<span class="params">JsonReader reader,</span></span></span><br><span class="line"><span class="params"><span class="function">        Type objectType,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">object</span> existingValue,</span></span></span><br><span class="line"><span class="params"><span class="function">        JsonSerializer serializer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 實作讀取邏輯</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">WriteJson</span>(<span class="params">JsonWriter writer,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">object</span> <span class="keyword">value</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        JsonSerializer serializer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 實作寫入邏輯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>選擇使用哪個JSON序列化器，主要取決於您的專案需求：</p>
<ol>
<li><p>如果您正在開發新專案，且不需要特殊的JSON處理功能，System.Text.Json是個好選擇。它提供更好的效能和更低的資源使用。</p>
</li>
<li><p>如果您的專案需要處理複雜的JSON結構，或需要特定的JSON處理功能，Newtonsoft.Json可能是更好的選擇。它提供更多的功能和更大的彈性。</p>
</li>
<li><p>對於現有的專案，如果已經使用Newtonsoft.Json且運作正常，沒有必要立即轉換到System.Text.Json。轉換成本可能超過效能提升帶來的效益。</p>
</li>
</ol>
<p>最重要的是，兩個函式庫都是優秀的工具，選擇應該基於您的具體需求，而不是簡單地追求最新技術。在做決定時，應考慮：</p>
<ul>
<li>專案的效能需求</li>
<li>團隊的經驗和熟悉度</li>
<li>專案的複雜度</li>
<li>維護成本</li>
<li>與其他套件的相容性</li>
</ul>
<p>選擇合適的工具，才能讓開發更有效率，專案更好維護。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">防駭客必學！一次搞懂 IIS HSTS 設定，告別 HTTPS 降級攻擊</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-06-26 11:18:46" itemprop="dateCreated datePublished" datetime="2024-06-26T11:18:46+08:00">2024-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-12-13 16:10:36" itemprop="dateModified" datetime="2024-12-13T16:10:36+08:00">2024-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%B3%87%E8%A8%8A%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">資訊安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>2 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="防駭客必學！一次搞懂-IIS-HSTS-設定，告別-HTTPS-降級攻擊"><a href="#防駭客必學！一次搞懂-IIS-HSTS-設定，告別-HTTPS-降級攻擊" class="headerlink" title="防駭客必學！一次搞懂 IIS HSTS 設定，告別 HTTPS 降級攻擊"></a>防駭客必學！一次搞懂 IIS HSTS 設定，告別 HTTPS 降級攻擊</h1><p>你的網站已經設定 HTTPS 了嗎？但是否知道光設定 HTTPS 還不夠安全？今天要和大家分享一個超重要的網站安全防護機制：HTTP Strict Transport Security (HSTS)，讓你的網站安全性更上一層樓！</p>
<h2 id="問題發現：弱點掃描警告"><a href="#問題發現：弱點掃描警告" class="headerlink" title="問題發現：弱點掃描警告"></a>問題發現：弱點掃描警告</h2><p>最近在進行專案的弱點掃描時，發現了一個低風險的問題：</p>
<p><img src="20240828112228876.png" alt="弱點掃描結果"></p>
<p>弱點說明提到：應用程式未設定 HTTP Strict Transport Security (HSTS) 標頭。這可能讓攻擊者有機會進行 HTTPS 降級攻擊，竊取敏感資訊。</p>
<h2 id="什麼是-HSTS？為什麼這麼重要？"><a href="#什麼是-HSTS？為什麼這麼重要？" class="headerlink" title="什麼是 HSTS？為什麼這麼重要？"></a>什麼是 HSTS？為什麼這麼重要？</h2><p>HSTS 全名是 HTTP Strict Transport Security，是一種由網際網路工程任務組（IETF）發布的網路安全政策。它的主要功能是：</p>
<ol>
<li>強制瀏覽器使用 HTTPS 與網站進行通訊</li>
<li>有效防禦 SSL 剝離攻擊</li>
<li>保護使用者的敏感資訊</li>
<li>避免憑證警告被忽略</li>
</ol>
<h3 id="HSTS-運作原理"><a href="#HSTS-運作原理" class="headerlink" title="HSTS 運作原理"></a>HSTS 運作原理</h3><p>讓我們看看 HSTS 是如何運作的：</p>
<ol>
<li>使用者第一次存取網站</li>
<li>伺服器在回應中加入 HSTS 標頭</li>
<li>瀏覽器記住這個安全設定</li>
<li>之後瀏覽器會自動將 HTTP 請求轉為 HTTPS</li>
<li>有效防止中間人攻擊</li>
</ol>
<h2 id="HSTS-的兩種設定方式"><a href="#HSTS-的兩種設定方式" class="headerlink" title="HSTS 的兩種設定方式"></a>HSTS 的兩種設定方式</h2><p>在 IIS 中，有兩種方式可以設定 HSTS：</p>
<h3 id="1-使用-CustomHeaders（簡單但不夠完善）"><a href="#1-使用-CustomHeaders（簡單但不夠完善）" class="headerlink" title="1. 使用 CustomHeaders（簡單但不夠完善）"></a>1. 使用 CustomHeaders（簡單但不夠完善）</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">httpProtocol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">customHeaders</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 設定 HSTS 標頭，max-age 單位為秒（此處設定一年） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;Strict-Transport-Security&quot;</span> <span class="attr">value</span>=<span class="string">&quot;max-age=31536000&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">customHeaders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">httpProtocol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-使用-URL-Rewrite（建議使用）"><a href="#2-使用-URL-Rewrite（建議使用）" class="headerlink" title="2. 使用 URL Rewrite（建議使用）"></a>2. 使用 URL Rewrite（建議使用）</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rewrite</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">outboundRules</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rule</span> <span class="attr">name</span>=<span class="string">&quot;Add HSTS Header&quot;</span> <span class="attr">enabled</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 比對所有回應 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">match</span> <span class="attr">serverVariable</span>=<span class="string">&quot;RESPONSE_Strict_Transport_Security&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">pattern</span>=<span class="string">&quot;.*&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">conditions</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 只在 HTTPS 連線時添加標頭 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;&#123;HTTPS&#125;&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;on&quot;</span> <span class="attr">ignoreCase</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">conditions</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 設定 HSTS 標頭內容 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">type</span>=<span class="string">&quot;Rewrite&quot;</span> <span class="attr">value</span>=<span class="string">&quot;max-age=31536000&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">outboundRules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rewrite</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="實務操作：在-IIS-上設定-HSTS"><a href="#實務操作：在-IIS-上設定-HSTS" class="headerlink" title="實務操作：在 IIS 上設定 HSTS"></a>實務操作：在 IIS 上設定 HSTS</h2><h3 id="步驟一：設定-HTTPS-重新導向"><a href="#步驟一：設定-HTTPS-重新導向" class="headerlink" title="步驟一：設定 HTTPS 重新導向"></a>步驟一：設定 HTTPS 重新導向</h3><ol>
<li><p>開啟 IIS 管理員</p>
</li>
<li><p>選擇你的網站，找到「URL Rewrite」模組<br><img src="20240828112904123.png" alt="IIS管理員介面"></p>
</li>
<li><p>新增輸入規則，設定如下：</p>
<ul>
<li>名稱：HTTP to HTTPS redirect</li>
<li>模式：(.*)</li>
<li>條件：{HTTPS} 選「符合模式」，填入 ^OFF$</li>
<li>動作：選「重新導向」，URL 填 https://{HTTP_HOST}/{R:1}<br><img src="20240828112957254.png" alt="重新導向設定"><br><img src="20240828113025526.png" alt="條件設定"></li>
</ul>
</li>
</ol>
<h3 id="步驟二：設定-HSTS-輸出規則"><a href="#步驟二：設定-HSTS-輸出規則" class="headerlink" title="步驟二：設定 HSTS 輸出規則"></a>步驟二：設定 HSTS 輸出規則</h3><ol>
<li>在「URL Rewrite」模組中新增輸出規則</li>
<li>設定內容：<ul>
<li>名稱：Add Strict-Transport-Security when HTTPS</li>
<li>變數名稱：RESPONSE_Strict_Transport_Security</li>
<li>模式：.*</li>
<li>條件：{HTTPS} 選「符合模式」，填入 ^ON$</li>
<li>動作：選「重寫」，值填入 max-age=31536000<br><img src="20240828113055808.png" alt="HSTS設定"><br><img src="20240828113107254.png" alt="完整設定"></li>
</ul>
</li>
</ol>
<p>記得設定完成後要重新啟動網站！</p>
<h2 id="常見問題-Q-amp-A"><a href="#常見問題-Q-amp-A" class="headerlink" title="常見問題 Q&amp;A"></a>常見問題 Q&amp;A</h2><h3 id="Q1-設定後出現重新導向次數過多怎麼辦？"><a href="#Q1-設定後出現重新導向次數過多怎麼辦？" class="headerlink" title="Q1: 設定後出現重新導向次數過多怎麼辦？"></a>Q1: 設定後出現重新導向次數過多怎麼辦？</h3><p>如果你的 SSL 憑證是在網域防火牆處理，需要修改設定：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">conditions</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 改用 X-Forwarded-Proto 檢查 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">input</span>=<span class="string">&quot;&#123;HTTP_X_FORWARDED_PROTO&#125;&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;https&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">conditions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Q2-要設定多久的-max-age-比較好？"><a href="#Q2-要設定多久的-max-age-比較好？" class="headerlink" title="Q2: 要設定多久的 max-age 比較好？"></a>Q2: 要設定多久的 max-age 比較好？</h3><ul>
<li>測試環境：建議 300 秒</li>
<li>正式環境：一般設定一年（31536000 秒）</li>
</ul>
<h3 id="Q3-如何驗證設定是否成功？"><a href="#Q3-如何驗證設定是否成功？" class="headerlink" title="Q3: 如何驗證設定是否成功？"></a>Q3: 如何驗證設定是否成功？</h3><ol>
<li>使用瀏覽器開發者工具檢查回應標頭</li>
<li>使用 <a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/">SSL Labs</a> 測試</li>
<li>嘗試用 HTTP 連線，應該會自動轉為 HTTPS</li>
</ol>
<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://owasp.org/www-project-cheat-sheets/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html">OWASP HSTS 安全指南</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Headers/Strict-Transport-Security">MDN Web Docs - HSTS</a></li>
</ol>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>網站安全不容忽視！透過正確設定 HSTS，你的網站就能有效防範 HTTPS 降級攻擊。記得要先在測試環境驗證設定，確認一切正常後再部署到正式環境。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/posts/undefined/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | kyosora 虛空筆記">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/undefined/" class="post-title-link" itemprop="url">WebSocket通訊過程詳解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2024-06-25 17:36:24" itemprop="dateCreated datePublished" datetime="2024-06-25T17:36:24+08:00">2024-06-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間：2024-11-27 14:36:14" itemprop="dateModified" datetime="2024-11-27T14:36:14+08:00">2024-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BC%8F%E6%95%99%E5%AD%B8/" itemprop="url" rel="index"><span itemprop="name">程式教學</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span class="firestore-visitors-count"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>1 分鐘</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="WebSocket通訊過程詳解"><a href="#WebSocket通訊過程詳解" class="headerlink" title="WebSocket通訊過程詳解"></a>WebSocket通訊過程詳解</h1><p>今天要跟各位分享的是WebSocket通訊的運作過程。不論是網頁開發新手,還是想深入了解網路協定的老鳥,這篇文章都能讓你對WebSocket有更全面的認識。</p>
<h2 id="WebSocket是什麼"><a href="#WebSocket是什麼" class="headerlink" title="WebSocket是什麼?"></a>WebSocket是什麼?</h2><p>WebSocket是一種網路通訊協定,它能在瀏覽器和伺服器之間建立全雙工、雙向的通訊管道。不同於傳統的HTTP請求-回應模式,WebSocket讓瀏覽器和伺服器可以隨時互相傳送訊息,而不需要重新發起連線。</p>
<h2 id="WebSocket通訊過程"><a href="#WebSocket通訊過程" class="headerlink" title="WebSocket通訊過程"></a>WebSocket通訊過程</h2><p>讓我們一步步來看WebSocket的通訊過程:</p>
<h3 id="1-建立連線"><a href="#1-建立連線" class="headerlink" title="1. 建立連線"></a>1. 建立連線</h3><ol>
<li>客戶端(通常是瀏覽器)向伺服器發送一個HTTP請求,要求升級連線為WebSocket。</li>
<li>這個請求會包含一些特殊的標頭:<ul>
<li><code>Upgrade: websocket</code></li>
<li><code>Connection: Upgrade</code></li>
<li><code>Sec-WebSocket-Key: [一個隨機生成的金鑰]</code></li>
<li><code>Sec-WebSocket-Version: 13</code></li>
</ul>
</li>
</ol>
<h3 id="2-伺服器回應"><a href="#2-伺服器回應" class="headerlink" title="2. 伺服器回應"></a>2. 伺服器回應</h3><ol>
<li>如果伺服器支援WebSocket,它會回應一個HTTP 101狀態碼(Switching Protocols)。</li>
<li>回應中也會包含特殊標頭:<ul>
<li><code>Upgrade: websocket</code></li>
<li><code>Connection: Upgrade</code></li>
<li><code>Sec-WebSocket-Accept: [根據客戶端發送的金鑰計算出的值]</code></li>
</ul>
</li>
</ol>
<h3 id="3-連線建立完成"><a href="#3-連線建立完成" class="headerlink" title="3. 連線建立完成"></a>3. 連線建立完成</h3><p>一旦客戶端收到伺服器的正確回應,WebSocket連線就建立成功了。現在,雙方可以開始互相傳送訊息。</p>
<h3 id="4-資料傳輸"><a href="#4-資料傳輸" class="headerlink" title="4. 資料傳輸"></a>4. 資料傳輸</h3><ol>
<li>WebSocket使用幀(Frame)來傳輸資料。每個幀都有一個小型的標頭,用來描述資料的類型和長度。</li>
<li>資料可以是文字或二進制格式。</li>
<li>雙方都可以隨時發送資料,不需要等待對方的回應。</li>
</ol>
<h3 id="5-心跳機制"><a href="#5-心跳機制" class="headerlink" title="5. 心跳機制"></a>5. 心跳機制</h3><ol>
<li>為了保持連線活躍,WebSocket協定包含了一個心跳機制。</li>
<li>客戶端或伺服器可以定期發送一個小型的Ping幀。</li>
<li>接收方必須回應一個Pong幀。</li>
</ol>
<h3 id="6-關閉連線"><a href="#6-關閉連線" class="headerlink" title="6. 關閉連線"></a>6. 關閉連線</h3><ol>
<li>任何一方都可以發起關閉連線的請求。</li>
<li>發送一個帶有狀態碼的關閉幀。</li>
<li>另一方接收到關閉幀後,也會回應一個關閉幀。</li>
<li>雙方都發送和接收到關閉幀後,連線正式關閉。</li>
</ol>
<h2 id="WebSocket的優點"><a href="#WebSocket的優點" class="headerlink" title="WebSocket的優點"></a>WebSocket的優點</h2><ol>
<li><strong>即時性</strong>: 資料可以立即傳送,不需要輪詢。</li>
<li><strong>效能</strong>: 相較於反覆建立HTTP連線,WebSocket更節省資源。</li>
<li><strong>雙向通訊</strong>: 伺服器可以主動向客戶端推送資料。</li>
<li><strong>較低延遲</strong>: 一旦連線建立,資料傳輸的延遲就很低。</li>
</ol>
<h2 id="適用場景"><a href="#適用場景" class="headerlink" title="適用場景"></a>適用場景</h2><p>WebSocket特別適合需要即時更新的應用,例如:</p>
<ul>
<li>線上遊戲</li>
<li>即時聊天室</li>
<li>股票行情顯示器</li>
<li>線上協作工具</li>
</ul>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>WebSocket為網路應用帶來了新的可能性,讓我們能夠建立更即時、互動性更強的網站和應用程式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一頁" aria-label="上一頁" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" title="下一頁" aria-label="下一頁" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">null </a>
  </div>
  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">kyosora</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="總字數">303k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="所需總閱讀時間">4:35</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="訪客總數">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="總瀏覽次數">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 強力驅動
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/yourname" class="github-corner" title="在 GitHub 上關注我" aria-label="在 GitHub 上關注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":null,"repo":null,"client_id":null,"client_secret":null,"admin_user":null,"distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"cd1d1b68dc71fe0d24f453f5d2353e45"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"kyosora/kyosora.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js" defer></script>

</body>
</html>
