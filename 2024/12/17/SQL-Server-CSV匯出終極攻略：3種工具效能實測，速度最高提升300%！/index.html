<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kyosora.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="前言每個資料庫管理員都曾遇過這種情況：老闆說「我要這個報表，越快越好」，結果你發現要匯出的資料有好幾億筆… 別擔心！本篇文章將完整介紹SQL Server三大CSV匯出工具：SQLCMD、BCP和SSIS的實戰技巧。透過實際案例分析和效能測試，教你如何選擇最適合的工具，並運用最佳化技巧大幅提升匯出效能！ 三大工具特色比較 SQLCMD 優點：彈性高、容易整合自動化流程、指令碼管理方便 缺點：需要撰">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL Server CSV匯出終極攻略：3種工具效能實測，速度最高提升300%！">
<meta property="og:url" content="https://kyosora.github.io/2024/12/17/SQL-Server-CSV%E5%8C%AF%E5%87%BA%E7%B5%82%E6%A5%B5%E6%94%BB%E7%95%A5%EF%BC%9A3%E7%A8%AE%E5%B7%A5%E5%85%B7%E6%95%88%E8%83%BD%E5%AF%A6%E6%B8%AC%EF%BC%8C%E9%80%9F%E5%BA%A6%E6%9C%80%E9%AB%98%E6%8F%90%E5%8D%87300%%EF%BC%81/index.html">
<meta property="og:site_name" content="kyosora 虛空筆記">
<meta property="og:description" content="前言每個資料庫管理員都曾遇過這種情況：老闆說「我要這個報表，越快越好」，結果你發現要匯出的資料有好幾億筆… 別擔心！本篇文章將完整介紹SQL Server三大CSV匯出工具：SQLCMD、BCP和SSIS的實戰技巧。透過實際案例分析和效能測試，教你如何選擇最適合的工具，並運用最佳化技巧大幅提升匯出效能！ 三大工具特色比較 SQLCMD 優點：彈性高、容易整合自動化流程、指令碼管理方便 缺點：需要撰">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2024-12-17T10:10:09.000Z">
<meta property="article:modified_time" content="2024-12-19T03:45:36.000Z">
<meta property="article:author" content="kyosora">
<meta property="article:tag" content="SQL Server">
<meta property="article:tag" content="SQLCMD">
<meta property="article:tag" content="BCP">
<meta property="article:tag" content="SSIS">
<meta property="article:tag" content="CSV匯出">
<meta property="article:tag" content="效能優化">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://kyosora.github.io/2024/12/17/SQL-Server-CSV%E5%8C%AF%E5%87%BA%E7%B5%82%E6%A5%B5%E6%94%BB%E7%95%A5%EF%BC%9A3%E7%A8%AE%E5%B7%A5%E5%85%B7%E6%95%88%E8%83%BD%E5%AF%A6%E6%B8%AC%EF%BC%8C%E9%80%9F%E5%BA%A6%E6%9C%80%E9%AB%98%E6%8F%90%E5%8D%87300%%EF%BC%81/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>SQL Server CSV匯出終極攻略：3種工具效能實測，速度最高提升300%！ | kyosora 虛空筆記</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kyosora 虛空筆記</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">技術探索與學習分享</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://kyosora.github.io/2024/12/17/SQL-Server-CSV%E5%8C%AF%E5%87%BA%E7%B5%82%E6%A5%B5%E6%94%BB%E7%95%A5%EF%BC%9A3%E7%A8%AE%E5%B7%A5%E5%85%B7%E6%95%88%E8%83%BD%E5%AF%A6%E6%B8%AC%EF%BC%8C%E9%80%9F%E5%BA%A6%E6%9C%80%E9%AB%98%E6%8F%90%E5%8D%87300%%EF%BC%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="kyosora">
      <meta itemprop="description" content="個人技術筆記和學習心得分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kyosora 虛空筆記">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQL Server CSV匯出終極攻略：3種工具效能實測，速度最高提升300%！
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2024-12-17 18:10:09" itemprop="dateCreated datePublished" datetime="2024-12-17T18:10:09+08:00">2024-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2024-12-19 11:45:36" itemprop="dateModified" datetime="2024-12-19T11:45:36+08:00">2024-12-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%B3%87%E6%96%99%E5%BA%AB%E7%AE%A1%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">資料庫管理</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>每個資料庫管理員都曾遇過這種情況：老闆說「我要這個報表，越快越好」，結果你發現要匯出的資料有好幾億筆…</p>
<p>別擔心！本篇文章將完整介紹SQL Server三大CSV匯出工具：SQLCMD、BCP和SSIS的實戰技巧。透過實際案例分析和效能測試，教你如何選擇最適合的工具，並運用最佳化技巧大幅提升匯出效能！</p>
<h2 id="三大工具特色比較"><a href="#三大工具特色比較" class="headerlink" title="三大工具特色比較"></a>三大工具特色比較</h2><ol>
<li>SQLCMD<ul>
<li>優點：彈性高、容易整合自動化流程、指令碼管理方便</li>
<li>缺點：需要撰寫較多程式碼</li>
<li>適用場景：自動化排程作業、需要客製化處理的匯出工作</li>
</ul>
</li>
<li>BCP (Bulk Copy Program)<ul>
<li>優點：效能最佳、記憶體使用率低、適合大量資料處理</li>
<li>缺點：彈性較低、特殊資料處理較複雜</li>
<li>適用場景：大量資料快速匯出、簡單資料結構</li>
</ul>
</li>
<li>SSIS (SQL Server Integration Services)<ul>
<li>優點：視覺化設計、功能完整、整合性高</li>
<li>缺點：設定複雜、維護成本較高</li>
<li>適用場景：複雜ETL流程、需要資料轉換處理</li>
</ul>
</li>
</ol>
<svg viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg">
  <text x="400" y="40" text-anchor="middle" font-size="24" fill="#333">SQL Server CSV匯出工具完整比較</text>
  <g transform="translate(0,80)">
    <rect x="50" y="20" width="200" height="120" rx="10" fill="#4A90E2"/>
    <text x="150" y="45" text-anchor="middle" font-size="16" fill="white">SQLCMD</text>
    <text x="150" y="70" text-anchor="middle" font-size="12" fill="white">優點:</text>
    <text x="150" y="90" text-anchor="middle" font-size="12" fill="white">- 彈性高</text>
    <text x="150" y="110" text-anchor="middle" font-size="12" fill="white">- 易於自動化</text>
    <text x="150" y="130" text-anchor="middle" font-size="12" fill="white">- 指令碼管理方便</text>
    <rect x="300" y="20" width="200" height="120" rx="10" fill="#81C784"/>
    <text x="400" y="45" text-anchor="middle" font-size="16" fill="white">BCP</text>
    <text x="400" y="70" text-anchor="middle" font-size="12" fill="white">優點:</text>
    <text x="400" y="90" text-anchor="middle" font-size="12" fill="white">- 效能最佳</text>
    <text x="400" y="110" text-anchor="middle" font-size="12" fill="white">- 資源使用率低</text>
    <text x="400" y="130" text-anchor="middle" font-size="12" fill="white">- 適合大量資料</text>
    <rect x="550" y="20" width="200" height="120" rx="10" fill="#7986CB"/>
    <text x="650" y="45" text-anchor="middle" font-size="16" fill="white">SSIS</text>
    <text x="650" y="70" text-anchor="middle" font-size="12" fill="white">優點:</text>
    <text x="650" y="90" text-anchor="middle" font-size="12" fill="white">- 視覺化設計</text>
    <text x="650" y="110" text-anchor="middle" font-size="12" fill="white">- 功能最完整</text>
    <text x="650" y="130" text-anchor="middle" font-size="12" fill="white">- 整合性高</text>
  </g>
  <g transform="translate(50,250)">
    <text x="350" y="20" text-anchor="middle" font-size="18" fill="#333">效能比較 (100GB資料匯出時間)</text>
    <line x1="100" y1="200" x2="700" y2="200" stroke="#666" stroke-width="2"/>
    <line x1="100" y1="50" x2="100" y2="200" stroke="#666" stroke-width="2"/>
    <rect x="200" y="100" width="60" height="100" fill="#4A90E2" opacity="0.8"/>
    <text x="230" y="220" text-anchor="middle" font-size="12">SQLCMD</text>
    <text x="230" y="90" text-anchor="middle" font-size="12">120分鐘</text>
    <rect x="400" y="70" width="60" height="130" fill="#81C784" opacity="0.8"/>
    <text x="430" y="220" text-anchor="middle" font-size="12">BCP</text>
    <text x="430" y="60" text-anchor="middle" font-size="12">90分鐘</text>
    <rect x="600" y="130" width="60" height="70" fill="#7986CB" opacity="0.8"/>
    <text x="630" y="220" text-anchor="middle" font-size="12">SSIS</text>
    <text x="630" y="120" text-anchor="middle" font-size="12">150分鐘</text>
  </g>
  <g transform="translate(50,500)">
    <text x="350" y="20" text-anchor="middle" font-size="18" fill="#333">適用場景比較</text>
    <rect x="50" y="40" width="200" height="80" rx="5" fill="#4A90E2" opacity="0.8"/>
    <text x="150" y="70" text-anchor="middle" font-size="14" fill="white">SQLCMD</text>
    <text x="150" y="90" text-anchor="middle" font-size="12" fill="white">自動化排程作業</text>
    <text x="150" y="110" text-anchor="middle" font-size="12" fill="white">需要客製化處理</text>
    <rect x="300" y="40" width="200" height="80" rx="5" fill="#81C784" opacity="0.8"/>
    <text x="400" y="70" text-anchor="middle" font-size="14" fill="white">BCP</text>
    <text x="400" y="90" text-anchor="middle" font-size="12" fill="white">大量資料快速匯出</text>
    <text x="400" y="110" text-anchor="middle" font-size="12" fill="white">簡單資料結構</text>
    <rect x="550" y="40" width="200" height="80" rx="5" fill="#7986CB" opacity="0.8"/>
    <text x="650" y="70" text-anchor="middle" font-size="14" fill="white">SSIS</text>
    <text x="650" y="90" text-anchor="middle" font-size="12" fill="white">複雜ETL流程</text>
    <text x="650" y="110" text-anchor="middle" font-size="12" fill="white">需要資料轉換</text>
  </g>
</svg>

<h2 id="SQLCMD-實戰技巧"><a href="#SQLCMD-實戰技巧" class="headerlink" title="SQLCMD 實戰技巧"></a>SQLCMD 實戰技巧</h2><h3 id="1-基本匯出腳本"><a href="#1-基本匯出腳本" class="headerlink" title="1. 基本匯出腳本"></a>1. 基本匯出腳本</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 設定CSV匯出參數</span>
:setvar OutputPath <span class="token string">"D:\Exports"</span>
:setvar FileName <span class="token string">"ExportData.csv"</span>
:setvar <span class="token keyword">Delimiter</span> <span class="token string">","</span>
:setvar BatchSize <span class="token number">10000</span>

<span class="token comment">-- 設定查詢結果格式</span>
:<span class="token keyword">on</span> error <span class="token keyword">exit</span>
<span class="token keyword">SET</span> NOCOUNT <span class="token keyword">ON</span>
<span class="token keyword">SET</span> QUOTED_IDENTIFIER <span class="token keyword">ON</span>

<span class="token comment">-- 建立匯出查詢</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@sql</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span>
<span class="token keyword">SET</span> <span class="token variable">@sql</span> <span class="token operator">=</span> <span class="token string">'
bcp "
SELECT Column1, Column2, Column3
FROM YourTable
" queryout "$(OutputPath)\$(FileName)" -c -t"$(Delimiter)" -T -S $(ServerName)
'</span>

<span class="token comment">-- 執行匯出</span>
<span class="token keyword">EXEC</span> sp_executesql <span class="token variable">@sql</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-大型資料處理優化"><a href="#2-大型資料處理優化" class="headerlink" title="2. 大型資料處理優化"></a>2. 大型資料處理優化</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 優化大型資料匯出效能</span>
:setvar ChunkSize <span class="token number">1000000</span>  <span class="token comment">-- 設定每個分割檔案的資料量</span>

<span class="token comment">-- 建立暫存資料表存放分割資訊</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token comment">#ExportChunks (</span>
    ChunkID <span class="token keyword">int</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StartID <span class="token keyword">bigint</span><span class="token punctuation">,</span>
    EndID <span class="token keyword">bigint</span>
<span class="token punctuation">)</span>

<span class="token comment">-- 計算分割區間</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token comment">#ExportChunks (StartID, EndID)</span>
<span class="token keyword">SELECT</span> 
    ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ID<span class="token punctuation">)</span> <span class="token keyword">AS</span> StartID<span class="token punctuation">,</span>
    LEAD<span class="token punctuation">(</span>ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ID<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ID<span class="token punctuation">)</span> <span class="token keyword">AS</span> EndID
<span class="token keyword">FROM</span> YourTable
<span class="token keyword">WHERE</span> ID <span class="token operator">%</span> $<span class="token punctuation">(</span>ChunkSize<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment">-- 使用迴圈處理每個分割檔案</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@ChunkID</span> <span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@MaxChunks</span> <span class="token keyword">int</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>ChunkID<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token comment">#ExportChunks)</span>

<span class="token keyword">WHILE</span> <span class="token variable">@ChunkID</span> <span class="token operator">&lt;=</span> <span class="token variable">@MaxChunks</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment">-- 匯出分割檔案</span>
    <span class="token keyword">DECLARE</span> <span class="token variable">@ChunkFileName</span> nvarchar<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'$(OutputPath)\Chunk_'</span> <span class="token operator">+</span> 
           CAST<span class="token punctuation">(</span><span class="token variable">@ChunkID</span> <span class="token keyword">as</span> nvarchar<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.csv'</span>
    
    <span class="token comment">-- 這裡加入您的匯出指令</span>
    <span class="token comment">-- ...</span>
    
    <span class="token keyword">SET</span> <span class="token variable">@ChunkID</span> <span class="token operator">=</span> <span class="token variable">@ChunkID</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-特殊字元處理"><a href="#3-特殊字元處理" class="headerlink" title="3. 特殊字元處理"></a>3. 特殊字元處理</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 處理CSV特殊字元</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dbo<span class="token punctuation">.</span>EscapeCSV
<span class="token punctuation">(</span>
    <span class="token variable">@text</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span>
<span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment">-- 處理雙引號</span>
    <span class="token keyword">SET</span> <span class="token variable">@text</span> <span class="token operator">=</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token variable">@text</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'""'</span><span class="token punctuation">)</span>
    
    <span class="token comment">-- 處理逗號和換行符</span>
    <span class="token keyword">IF</span> <span class="token variable">@text</span> <span class="token operator">LIKE</span> <span class="token string">'%[,\r\n]%'</span>
        <span class="token keyword">SET</span> <span class="token variable">@text</span> <span class="token operator">=</span> <span class="token string">'"'</span> <span class="token operator">+</span> <span class="token variable">@text</span> <span class="token operator">+</span> <span class="token string">'"'</span>
    
    <span class="token keyword">RETURN</span> <span class="token variable">@text</span>
<span class="token keyword">END</span>

<span class="token comment">-- 在匯出時使用</span>
<span class="token keyword">SELECT</span> 
    dbo<span class="token punctuation">.</span>EscapeCSV<span class="token punctuation">(</span>Column1<span class="token punctuation">)</span> <span class="token keyword">as</span> Column1<span class="token punctuation">,</span>
    dbo<span class="token punctuation">.</span>EscapeCSV<span class="token punctuation">(</span>Column2<span class="token punctuation">)</span> <span class="token keyword">as</span> Column2
<span class="token keyword">FROM</span> YourTable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="效能優化技巧"><a href="#效能優化技巧" class="headerlink" title="效能優化技巧"></a>效能優化技巧</h2><ol>
<li><p>記憶體最佳化</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 設定最佳記憶體使用量</span>
sqlcmd <span class="token operator">-</span>S ServerName <span class="token operator">-</span>b <span class="token operator">-</span>m <span class="token number">65535</span> <span class="token operator">-</span>U DBAdmin <span class="token operator">-</span>P Password <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>平行處理</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 啟用平行處理</span>
:setvar MAXDOP <span class="token number">4</span>
GO
sp_configure <span class="token string">'max degree of parallelism'</span><span class="token punctuation">,</span> $<span class="token punctuation">(</span>MAXDOP<span class="token punctuation">)</span>
GO
<span class="token keyword">RECONFIGURE</span> <span class="token keyword">WITH</span> OVERRIDE
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>批次處理優化</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 設定最佳批次大小</span>
:setvar BATCHSIZE <span class="token number">10000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="實戰案例分享"><a href="#實戰案例分享" class="headerlink" title="實戰案例分享"></a>實戰案例分享</h2><h3 id="案例一：千萬筆交易資料匯出"><a href="#案例一：千萬筆交易資料匯出" class="headerlink" title="案例一：千萬筆交易資料匯出"></a>案例一：千萬筆交易資料匯出</h3><p>在某專案中，需要匯出千萬筆紀錄進行分析。使用傳統方式可能需要24小時以上，但透過以下最佳化設定，我們將時間縮短到2小時：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 優化設定</span>
:setvar MAXDOP <span class="token number">8</span>          <span class="token comment">-- 設定平行處理數</span>
:setvar BATCHSIZE <span class="token number">50000</span>   <span class="token comment">-- 設定批次大小</span>
:setvar BufferSize <span class="token number">4096</span>   <span class="token comment">-- 設定緩衝區大小</span>

<span class="token comment">-- 匯出腳本</span>
:<span class="token keyword">on</span> error <span class="token keyword">exit</span>
<span class="token keyword">SET</span> NOCOUNT <span class="token keyword">ON</span>

<span class="token comment">-- 分割處理</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@StartID</span> <span class="token keyword">bigint</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@EndID</span> <span class="token keyword">bigint</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@ChunkSize</span> <span class="token keyword">bigint</span> <span class="token operator">=</span> <span class="token number">1000000</span>

<span class="token keyword">WHILE</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token number">1</span> 
    <span class="token keyword">FROM</span> <span class="token keyword">Transactions</span> 
    <span class="token keyword">WHERE</span> ID <span class="token operator">>=</span> <span class="token variable">@StartID</span>
<span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SET</span> <span class="token variable">@EndID</span> <span class="token operator">=</span> <span class="token variable">@StartID</span> <span class="token operator">+</span> <span class="token variable">@ChunkSize</span> <span class="token operator">-</span> <span class="token number">1</span>
    
    <span class="token comment">-- 匯出當前區間資料</span>
    <span class="token keyword">EXEC</span> sp_executesql N<span class="token string">'
    bcp "
    SELECT *
    FROM Transactions
    WHERE ID BETWEEN @StartID AND @EndID
    ORDER BY ID
    " queryout "D:\Export\Chunk_$(StartID).csv" -c -t"," -T
    '</span><span class="token punctuation">,</span> N<span class="token string">'@StartID bigint, @EndID bigint'</span><span class="token punctuation">,</span>
    <span class="token variable">@StartID</span><span class="token punctuation">,</span> <span class="token variable">@EndID</span>
    
    <span class="token keyword">SET</span> <span class="token variable">@StartID</span> <span class="token operator">=</span> <span class="token variable">@EndID</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="BCP-實戰技巧"><a href="#BCP-實戰技巧" class="headerlink" title="BCP 實戰技巧"></a>BCP 實戰技巧</h2><h3 id="1-基本語法"><a href="#1-基本語法" class="headerlink" title="1. 基本語法"></a>1. 基本語法</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- BCP基本匯出語法</span>
bcp <span class="token string">"SELECT * FROM DatabaseName.dbo.TableName"</span> 
queryout <span class="token string">"D:\Export\output.csv"</span> 
<span class="token operator">-</span>c                              <span class="token comment">-- 字元格式</span>
<span class="token operator">-</span>t<span class="token string">","</span>                           <span class="token comment">-- 分隔符號</span>
<span class="token operator">-</span>S ServerName                   <span class="token comment">-- 伺服器名稱</span>
<span class="token operator">-</span>T                             <span class="token comment">-- Windows驗證</span>
<span class="token operator">-</span>U Username                     <span class="token comment">-- SQL驗證使用者名稱</span>
<span class="token operator">-</span>P Password                     <span class="token comment">-- SQL驗證密碼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-效能優化設定"><a href="#2-效能優化設定" class="headerlink" title="2. 效能優化設定"></a>2. 效能優化設定</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 最佳化參數設定</span>
bcp <span class="token string">"SELECT * FROM YourTable"</span> 
queryout <span class="token string">"output.csv"</span> 
<span class="token operator">-</span>b <span class="token number">10000</span>                        <span class="token comment">-- 批次大小</span>
<span class="token operator">-</span>a <span class="token number">16384</span>                        <span class="token comment">-- 封包大小</span>
<span class="token operator">-</span>O                             <span class="token comment">-- 保持身份值</span>
<span class="token operator">-</span>h <span class="token string">"TABLOCK"</span>                    <span class="token comment">-- 資料表鎖定提示</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-大型資料處理"><a href="#3-大型資料處理" class="headerlink" title="3. 大型資料處理"></a>3. 大型資料處理</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 處理大型資料的腳本</span>
<span class="token variable">@echo</span> <span class="token keyword">off</span>
setlocal enabledelayedexpansion

<span class="token comment">-- 設定變數</span>
<span class="token keyword">set</span> SERVER<span class="token operator">=</span>YourServer
<span class="token keyword">set</span> <span class="token keyword">DATABASE</span><span class="token operator">=</span>YourDB
<span class="token keyword">set</span> <span class="token keyword">TABLE</span><span class="token operator">=</span>YourTable
<span class="token keyword">set</span> EXPORTPATH<span class="token operator">=</span>D:\Export
<span class="token keyword">set</span> BATCHSIZE<span class="token operator">=</span><span class="token number">1000000</span>

<span class="token comment">-- 分割處理大型資料</span>
<span class="token keyword">for</span> <span class="token operator">/</span>L <span class="token operator">%</span><span class="token operator">%</span>i <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token punctuation">(</span>
    <span class="token keyword">set</span> <span class="token operator">/</span>a <span class="token keyword">START</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token operator">%</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">%</span>BATCHSIZE<span class="token operator">%</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
    <span class="token keyword">set</span> <span class="token operator">/</span>a <span class="token keyword">END</span><span class="token operator">=</span><span class="token operator">%</span><span class="token operator">%</span>i<span class="token operator">*</span><span class="token operator">%</span>BATCHSIZE<span class="token operator">%</span>
    
    bcp <span class="token string">"SELECT * FROM %DATABASE%.dbo.%TABLE% 
         WHERE ID BETWEEN !START! AND !END!
         ORDER BY ID"</span> 
    queryout <span class="token string">"%EXPORTPATH%\Part_%%i.csv"</span> 
    <span class="token operator">-</span>c <span class="token operator">-</span>t<span class="token string">","</span> <span class="token operator">-</span>S <span class="token operator">%</span>SERVER<span class="token operator">%</span> <span class="token operator">-</span>T
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SSIS-實戰技巧"><a href="#SSIS-實戰技巧" class="headerlink" title="SSIS 實戰技巧"></a>SSIS 實戰技巧</h2><h3 id="1-基本元件設定"><a href="#1-基本元件設定" class="headerlink" title="1. 基本元件設定"></a>1. 基本元件設定</h3><p>在SSIS中建立CSV匯出流程：</p>
<ol>
<li><p>資料流程工作</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 來源查詢優化</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> YourTable <span class="token keyword">WITH</span> <span class="token punctuation">(</span>NOLOCK<span class="token punctuation">)</span>    <span class="token comment">-- 降低鎖定影響</span>
<span class="token keyword">OPTION</span> <span class="token punctuation">(</span>MAXDOP <span class="token number">4</span><span class="token punctuation">)</span>               <span class="token comment">-- 設定平行處理</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>轉換元件設定</p>
<ul>
<li>資料轉換：設定適當的緩衝區大小</li>
<li>排序：依需求設定索引鍵</li>
<li>條件分割：處理特殊資料</li>
</ul>
</li>
<li><p>目的地元件</p>
<ul>
<li>選擇「一般檔案目的地」</li>
<li>設定適當的編碼格式</li>
<li>設定錯誤處理機制</li>
</ul>
</li>
</ol>
<h3 id="2-效能優化技巧"><a href="#2-效能優化技巧" class="headerlink" title="2. 效能優化技巧"></a>2. 效能優化技巧</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- SSIS專案屬性設定</span>
<span class="token comment">-- 1. 緩衝區設定</span>
BufferTempStoragePath <span class="token operator">=</span> <span class="token string">"D:\SSIS\Temp"</span>    <span class="token comment">-- 設定暫存路徑</span>
DefaultBufferMaxRows <span class="token operator">=</span> <span class="token number">10000</span>               <span class="token comment">-- 設定緩衝區大小</span>
DefaultBufferSize <span class="token operator">=</span> <span class="token number">10485760</span>               <span class="token comment">-- 設定緩衝記憶體大小</span>

<span class="token comment">-- 2. 引擎設定</span>
MaxConcurrentExecutables <span class="token operator">=</span> <span class="token number">4</span>               <span class="token comment">-- 設定平行處理數</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-自動化部署"><a href="#3-自動化部署" class="headerlink" title="3. 自動化部署"></a>3. 自動化部署</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># PowerShell部署腳本</span>
<span class="token variable">$SSISNamespace</span> = <span class="token string">"Microsoft.SqlServer.Management.IntegrationServices"</span>
<span class="token variable">$Server</span> = <span class="token function">New-Object</span> Microsoft<span class="token punctuation">.</span>SqlServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>Server<span class="token punctuation">(</span><span class="token variable">$ServerName</span><span class="token punctuation">)</span>
<span class="token variable">$Catalog</span> = <span class="token function">New-Object</span> <span class="token string">"<span class="token variable">$SSISNamespace</span>.IntegrationServices"</span> <span class="token variable">$Server</span>

<span class="token comment"># 部署專案</span>
<span class="token variable">$Project</span> = <span class="token variable">$Folder</span><span class="token punctuation">.</span>DeployProject<span class="token punctuation">(</span>
    <span class="token variable">$ProjectFilePath</span><span class="token punctuation">,</span>
    <span class="token variable">$ProjectName</span><span class="token punctuation">,</span>
    <span class="token variable">$ProjectDescription</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="實戰案例分享-1"><a href="#實戰案例分享-1" class="headerlink" title="實戰案例分享"></a>實戰案例分享</h2><h3 id="案例一：客戶資料匯出"><a href="#案例一：客戶資料匯出" class="headerlink" title="案例一：客戶資料匯出"></a>案例一：客戶資料匯出</h3><p>情境：需要每日匯出500萬筆客戶紀錄</p>
<p>解決方案：</p>
<ol>
<li>使用BCP進行快速匯出<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 分割匯出腳本</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@StartDate</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'2024-01-01'</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@EndDate</span> <span class="token keyword">datetime</span> <span class="token operator">=</span> <span class="token string">'2024-01-02'</span>

<span class="token comment">-- 建立暫存資料表存放分割區間</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token comment">#DateRanges (</span>
    RangeID <span class="token keyword">int</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StartTime <span class="token keyword">datetime</span><span class="token punctuation">,</span>
    EndTime <span class="token keyword">datetime</span>
<span class="token punctuation">)</span>

<span class="token comment">-- 產生15分鐘區間</span>
<span class="token keyword">WHILE</span> <span class="token variable">@StartDate</span> <span class="token operator">&lt;</span> <span class="token variable">@EndDate</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token comment">#DateRanges (StartTime, EndTime)</span>
    <span class="token keyword">SELECT</span> 
        <span class="token variable">@StartDate</span><span class="token punctuation">,</span>
        DATEADD<span class="token punctuation">(</span><span class="token keyword">minute</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token variable">@StartDate</span><span class="token punctuation">)</span>
    
    <span class="token keyword">SET</span> <span class="token variable">@StartDate</span> <span class="token operator">=</span> DATEADD<span class="token punctuation">(</span><span class="token keyword">minute</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token variable">@StartDate</span><span class="token punctuation">)</span>
<span class="token keyword">END</span>

<span class="token comment">-- 平行處理匯出</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@RangeID</span> <span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@MaxRangeID</span> <span class="token keyword">int</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>RangeID<span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token comment">#DateRanges)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@ThreadCount</span> <span class="token keyword">int</span> <span class="token operator">=</span> <span class="token number">4</span>                                    <span class="token comment">-- 設定平行處理數</span>

<span class="token keyword">WHILE</span> <span class="token variable">@RangeID</span> <span class="token operator">&lt;=</span> <span class="token variable">@MaxRangeID</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment">-- 檢查執行中的處理程序數</span>
    <span class="token keyword">WHILE</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>dm_exec_requests 
           <span class="token keyword">WHERE</span> command <span class="token operator">=</span> <span class="token string">'BCP'</span> <span class="token operator">AND</span> wait_type <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'SLEEP_TASK'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token variable">@ThreadCount</span>
    <span class="token keyword">BEGIN</span>
        <span class="token keyword">WAITFOR</span> DELAY <span class="token string">'00:00:01'</span>
    <span class="token keyword">END</span>
    
    <span class="token comment">-- 啟動新的BCP處理程序</span>
    <span class="token keyword">DECLARE</span> <span class="token variable">@BCPCommand</span> nvarchar<span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>
    <span class="token keyword">SELECT</span> <span class="token variable">@BCPCommand</span> <span class="token operator">=</span> <span class="token string">'
    bcp "
    SELECT * 
    FROM CallRecords 
    WHERE CallTime BETWEEN '''</span> <span class="token operator">+</span> 
    <span class="token keyword">CONVERT</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">,</span> StartTime<span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">''' AND '''</span> <span class="token operator">+</span>
    <span class="token keyword">CONVERT</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">,</span> EndTime<span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'''
    " queryout "D:\Export\CallRecords_'</span> <span class="token operator">+</span> 
    CAST<span class="token punctuation">(</span>RangeID <span class="token keyword">as</span> <span class="token keyword">varchar</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.csv" -c -t"," -S $(ServerName) -T
    '</span>
    <span class="token keyword">FROM</span> <span class="token comment">#DateRanges</span>
    <span class="token keyword">WHERE</span> RangeID <span class="token operator">=</span> <span class="token variable">@RangeID</span>
    
    <span class="token comment">-- 執行BCP命令</span>
    <span class="token keyword">EXEC</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>xp_cmdshell <span class="token variable">@BCPCommand</span>
    
    <span class="token keyword">SET</span> <span class="token variable">@RangeID</span> <span class="token operator">=</span> <span class="token variable">@RangeID</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<p>效能優化重點：</p>
<ol>
<li>使用時間區間分割資料</li>
<li>設定適當的平行處理數</li>
<li>監控系統資源使用情況</li>
<li>錯誤處理機制</li>
</ol>
<p>實際效能：</p>
<ul>
<li>原本單執行緒需要4小時</li>
<li>優化後只需40分鐘</li>
<li>CPU使用率維持在70%左右</li>
<li>記憶體使用穩定</li>
</ul>
<h3 id="案例二：交易資料匯出"><a href="#案例二：交易資料匯出" class="headerlink" title="案例二：交易資料匯出"></a>案例二：交易資料匯出</h3><p>情境：券商需要每日收盤後30分鐘內完成百萬筆交易資料的匯出並進行格式轉換</p>
<p>解決方案：結合BCP和SSIS的優點</p>
<ol>
<li><p>使用BCP快速匯出原始資料</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 交易資料快速匯出</span>
bcp <span class="token string">"
SELECT t.*, 
       a.AccountName,
       s.StockName,
       s.MarketType
FROM Transactions t
JOIN Accounts a ON t.AccountID = a.AccountID
JOIN Stocks s ON t.StockID = s.StockID
WHERE t.TransDate = CAST(GETDATE() AS date)
"</span> queryout <span class="token string">"D:\Export\RawData.csv"</span> <span class="token operator">-</span>c <span class="token operator">-</span>t<span class="token string">","</span> <span class="token operator">-</span>S $<span class="token punctuation">(</span>ServerName<span class="token punctuation">)</span> <span class="token operator">-</span>T<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>使用SSIS進行資料轉換</p>
</li>
</ol>
<ul>
<li>建立資料流程任務</li>
<li>設定CSV來源元件</li>
<li>加入資料轉換元件：<ul>
<li>特殊字元處理</li>
<li>金額格式轉換</li>
<li>編碼轉換</li>
<li>異常資料過濾</li>
</ul>
</li>
<li>設定匯出格式</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- SSIS指令碼任務 - 資料轉換</span>
<span class="token keyword">public</span> void Main<span class="token punctuation">(</span><span class="token punctuation">)</span>
&#123;
    <span class="token comment">// 設定來源連接</span>
    string sourceFile <span class="token operator">=</span> <span class="token variable">@"D:\Export\RawData.csv"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 設定緩衝區大小</span>
    BufferSize <span class="token operator">=</span> <span class="token number">10485760</span><span class="token punctuation">;</span>              <span class="token comment">-- 10MB緩衝區</span>
    DefaultBufferMaxRows <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>        <span class="token comment">-- 每批次處理筆數</span>
    
    <span class="token comment">// 設定錯誤處理</span>
    try
    &#123;
        <span class="token comment">// 執行資料轉換</span>
        foreach <span class="token punctuation">(</span><span class="token keyword">row</span> <span class="token operator">in</span> Source<span class="token punctuation">)</span>
        &#123;
            <span class="token comment">// 處理特殊字元</span>
            <span class="token keyword">row</span><span class="token punctuation">.</span>AccountName <span class="token operator">=</span> HandleSpecialChars<span class="token punctuation">(</span><span class="token keyword">row</span><span class="token punctuation">.</span>AccountName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 轉換金額格式</span>
            <span class="token keyword">row</span><span class="token punctuation">.</span>Amount <span class="token operator">=</span> FormatCurrency<span class="token punctuation">(</span><span class="token keyword">row</span><span class="token punctuation">.</span>Amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 寫入目標檔案</span>
            WriteToTarget<span class="token punctuation">(</span><span class="token keyword">row</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        &#125;
    &#125;
    catch <span class="token punctuation">(</span>Exception ex<span class="token punctuation">)</span>
    &#123;
        <span class="token comment">// 記錄錯誤</span>
        LogError<span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        throw<span class="token punctuation">;</span>
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>自動化排程設定<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># PowerShell自動化腳本</span>
<span class="token variable">$dtStart</span> = <span class="token function">Get-Date</span> <span class="token string">"15:00"</span>              <span class="token comment"># 設定開始時間</span>
<span class="token variable">$dtEnd</span> = <span class="token function">Get-Date</span> <span class="token string">"15:30"</span>                <span class="token comment"># 設定結束時間</span>

<span class="token comment"># 監控資料匯出狀態</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">Get-Date</span><span class="token punctuation">)</span> <span class="token operator">-lt</span> <span class="token variable">$dtEnd</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># 檢查匯出進度</span>
    <span class="token variable">$progress</span> = <span class="token function">Get-ExportProgress</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$progress</span><span class="token punctuation">.</span>Status <span class="token operator">-eq</span> <span class="token string">"Completed"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment"># 開始SSIS轉換</span>
        <span class="token function">Start-SSISPackage</span> <span class="token operator">-</span>Path <span class="token string">"D:\SSIS\DataTransform.dtsx"</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">Start-Sleep</span> <span class="token operator">-</span>Seconds 30
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<p>實際效能：</p>
<ul>
<li>BCP匯出：5分鐘</li>
<li>SSIS轉換：15分鐘</li>
<li>總耗時：20分鐘</li>
<li>成功率：99.9%</li>
</ul>
<h2 id="工具選擇建議"><a href="#工具選擇建議" class="headerlink" title="工具選擇建議"></a>工具選擇建議</h2><p>根據情境選擇合適的工具：</p>
<ol>
<li><p>單純資料匯出</p>
<ul>
<li>資料量 &lt; 100萬筆：SQLCMD</li>
<li>資料量 &gt; 100萬筆：BCP</li>
</ul>
</li>
<li><p>需要資料轉換</p>
<ul>
<li>簡單轉換：SQLCMD</li>
<li>複雜轉換：SSIS</li>
</ul>
</li>
<li><p>自動化需求</p>
<ul>
<li>單一任務：BCP + 排程</li>
<li>複雜流程：SSIS</li>
</ul>
</li>
<li><p>整合應用</p>
<ul>
<li>BCP + SSIS：大量資料配合複雜轉換</li>
<li>SQLCMD + BCP：彈性控制配合快速匯出</li>
<li>三者整合：完整ETL解決方案</li>
</ul>
</li>
</ol>
<h2 id="效能優化重點"><a href="#效能優化重點" class="headerlink" title="效能優化重點"></a>效能優化重點</h2><ol>
<li>系統層級<ul>
<li>CPU平行處理設定</li>
<li>記憶體分配</li>
<li>磁碟I/O最佳化</li>
</ul>
</li>
<li>應用層級<ul>
<li>批次處理大小</li>
<li>緩衝區設定</li>
<li>交易控制</li>
</ul>
</li>
<li>網路層級<ul>
<li>封包大小設定</li>
<li>網路延遲處理</li>
<li>連線池設定</li>
</ul>
</li>
</ol>
<h2 id="常見問題解決方案"><a href="#常見問題解決方案" class="headerlink" title="常見問題解決方案"></a>常見問題解決方案</h2><ol>
<li><p>編碼問題</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 設定正確的編碼格式</span>
bcp <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">-</span>C <span class="token number">65001</span>                         
<span class="token comment">-- 使用UTF-8編碼</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>特殊字元處理</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 建立特殊字元處理函數</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dbo<span class="token punctuation">.</span>HandleSpecialChars
<span class="token punctuation">(</span>
    <span class="token variable">@text</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> nvarchar<span class="token punctuation">(</span>max<span class="token punctuation">)</span>
<span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SET</span> <span class="token variable">@text</span> <span class="token operator">=</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token variable">@text</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'""'</span><span class="token punctuation">)</span>    
    <span class="token comment">-- 處理雙引號</span>
    <span class="token keyword">SET</span> <span class="token variable">@text</span> <span class="token operator">=</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token variable">@text</span><span class="token punctuation">,</span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  
    <span class="token comment">-- 處理換行符</span>
    <span class="token keyword">SET</span> <span class="token variable">@text</span> <span class="token operator">=</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token variable">@text</span><span class="token punctuation">,</span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  
    <span class="token comment">-- 處理換行符</span>
    
    <span class="token keyword">RETURN</span> <span class="token variable">@text</span>
<span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>效能監控</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 建立效能監控查詢</span>
<span class="token keyword">SELECT</span> 
    r<span class="token punctuation">.</span>session_id<span class="token punctuation">,</span>
    r<span class="token punctuation">.</span>start_time<span class="token punctuation">,</span>
    r<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token punctuation">,</span>
    r<span class="token punctuation">.</span>command<span class="token punctuation">,</span>
    r<span class="token punctuation">.</span>cpu_time<span class="token punctuation">,</span>
    r<span class="token punctuation">.</span>total_elapsed_time<span class="token punctuation">,</span>
    r<span class="token punctuation">.</span><span class="token keyword">reads</span><span class="token punctuation">,</span>
    r<span class="token punctuation">.</span>writes<span class="token punctuation">,</span>
    r<span class="token punctuation">.</span>logical_reads
<span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>dm_exec_requests r
<span class="token keyword">WHERE</span> r<span class="token punctuation">.</span>command <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'BCP'</span><span class="token punctuation">,</span> <span class="token string">'BULK INSERT'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>透過本文介紹的實戰技巧，你現在應該能夠：</p>
<ul>
<li>根據情境選擇最適合的工具</li>
<li>優化匯出效能達到最佳狀態</li>
<li>處理各種匯出相關問題</li>
<li>建立完整的自動化解決方案</li>
</ul>
<p>要記住：沒有一個工具適合所有情境，關鍵是要根據實際需求選擇合適的工具組合，並且持續優化調整！</p>
<h2 id="參考資源"><a href="#參考資源" class="headerlink" title="參考資源"></a>參考資源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/sql/">SQL Server官方文件</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/sql/integration-services/best-practices">SSIS最佳實踐指南</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/sql/tools/bcp-utility">BCP命令列參考</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/sql/relational-databases/performance/performance-center-for-sql-server-database-engine-and-azure-sql-database">SQL Server效能調校指南</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SQL-Server/" rel="tag"># SQL Server</a>
              <a href="/tags/SQLCMD/" rel="tag"># SQLCMD</a>
              <a href="/tags/BCP/" rel="tag"># BCP</a>
              <a href="/tags/SSIS/" rel="tag"># SSIS</a>
              <a href="/tags/CSV%E5%8C%AF%E5%87%BA/" rel="tag"># CSV匯出</a>
              <a href="/tags/%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96/" rel="tag"># 效能優化</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/12/16/SQL-Server-%E8%B3%87%E6%96%99%E5%BA%AB%E7%AE%A1%E7%90%86%E5%BF%85%E5%AD%B8%E7%A7%98%E6%8A%80%EF%BC%9A%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%A9%A2%E7%89%A9%E4%BB%B6%E4%BF%AE%E6%94%B9%E6%99%82%E9%96%93/" rel="prev" title="SQL Server 資料庫管理必學秘技：快速查詢物件修改時間">
      <i class="fa fa-chevron-left"></i> SQL Server 資料庫管理必學秘技：快速查詢物件修改時間
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/12/19/%E5%9C%96%E8%A7%A3-C#-yield---5%E5%88%86%E9%90%98%E8%AE%93%E4%BD%A0%E8%BC%95%E9%AC%86%E6%8E%8C%E6%8F%A1%E8%BF%AD%E4%BB%A3%E5%99%A8/" rel="next" title="圖解 C# yield - 5分鐘讓你輕鬆掌握迭代器">
      圖解 C# yield - 5分鐘讓你輕鬆掌握迭代器 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7%E5%B7%A5%E5%85%B7%E7%89%B9%E8%89%B2%E6%AF%94%E8%BC%83"><span class="nav-number">2.</span> <span class="nav-text">三大工具特色比較</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQLCMD-%E5%AF%A6%E6%88%B0%E6%8A%80%E5%B7%A7"><span class="nav-number">3.</span> <span class="nav-text">SQLCMD 實戰技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%8C%AF%E5%87%BA%E8%85%B3%E6%9C%AC"><span class="nav-number">3.1.</span> <span class="nav-text">1. 基本匯出腳本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%A4%A7%E5%9E%8B%E8%B3%87%E6%96%99%E8%99%95%E7%90%86%E5%84%AA%E5%8C%96"><span class="nav-number">3.2.</span> <span class="nav-text">2. 大型資料處理優化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%89%B9%E6%AE%8A%E5%AD%97%E5%85%83%E8%99%95%E7%90%86"><span class="nav-number">3.3.</span> <span class="nav-text">3. 特殊字元處理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96%E6%8A%80%E5%B7%A7"><span class="nav-number">4.</span> <span class="nav-text">效能優化技巧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B%E5%88%86%E4%BA%AB"><span class="nav-number">5.</span> <span class="nav-text">實戰案例分享</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%8D%83%E8%90%AC%E7%AD%86%E4%BA%A4%E6%98%93%E8%B3%87%E6%96%99%E5%8C%AF%E5%87%BA"><span class="nav-number">5.1.</span> <span class="nav-text">案例一：千萬筆交易資料匯出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BCP-%E5%AF%A6%E6%88%B0%E6%8A%80%E5%B7%A7"><span class="nav-number">6.</span> <span class="nav-text">BCP 實戰技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E8%AA%9E%E6%B3%95"><span class="nav-number">6.1.</span> <span class="nav-text">1. 基本語法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96%E8%A8%AD%E5%AE%9A"><span class="nav-number">6.2.</span> <span class="nav-text">2. 效能優化設定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%A4%A7%E5%9E%8B%E8%B3%87%E6%96%99%E8%99%95%E7%90%86"><span class="nav-number">6.3.</span> <span class="nav-text">3. 大型資料處理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSIS-%E5%AF%A6%E6%88%B0%E6%8A%80%E5%B7%A7"><span class="nav-number">7.</span> <span class="nav-text">SSIS 實戰技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%85%83%E4%BB%B6%E8%A8%AD%E5%AE%9A"><span class="nav-number">7.1.</span> <span class="nav-text">1. 基本元件設定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96%E6%8A%80%E5%B7%A7"><span class="nav-number">7.2.</span> <span class="nav-text">2. 效能優化技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%87%AA%E5%8B%95%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="nav-number">7.3.</span> <span class="nav-text">3. 自動化部署</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%A6%E6%88%B0%E6%A1%88%E4%BE%8B%E5%88%86%E4%BA%AB-1"><span class="nav-number">8.</span> <span class="nav-text">實戰案例分享</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%9A%E5%AE%A2%E6%88%B6%E8%B3%87%E6%96%99%E5%8C%AF%E5%87%BA"><span class="nav-number">8.1.</span> <span class="nav-text">案例一：客戶資料匯出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%9A%E4%BA%A4%E6%98%93%E8%B3%87%E6%96%99%E5%8C%AF%E5%87%BA"><span class="nav-number">8.2.</span> <span class="nav-text">案例二：交易資料匯出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E9%81%B8%E6%93%87%E5%BB%BA%E8%AD%B0"><span class="nav-number">9.</span> <span class="nav-text">工具選擇建議</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96%E9%87%8D%E9%BB%9E"><span class="nav-number">10.</span> <span class="nav-text">效能優化重點</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%A1%88"><span class="nav-number">11.</span> <span class="nav-text">常見問題解決方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B5%90%E8%AB%96"><span class="nav-number">12.</span> <span class="nav-text">結論</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%BA%90"><span class="nav-number">13.</span> <span class="nav-text">參考資源</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">kyosora</p>
  <div class="site-description" itemprop="description">個人技術筆記和學習心得分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">99</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分類</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">118</span>
        <span class="site-state-item-name">標籤</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kyosora</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
